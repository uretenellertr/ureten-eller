<!DOCTYPE html>
<html lang="tr" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ä°lan OluÅŸtur â€¢ Ãœreten Eller</title>
  <meta name="description" content="Ãœreten Eller'de ilan oluÅŸturun. PREMIUM Ã¼yeler 10 ilan + 1 vitrin hakkÄ±. Her ilan 30 gÃ¼n yayÄ±nda." />
  <link rel="icon" href="/assets/icons/favicon-32x32.png" />
  <style>
    :root{ --bg1:#0b1220; --bg2:#0a0f1c; --card:#0e172a; --ink:#e5e7eb; --muted:#9ca3af; --accent:#22d3ee; --ok:#10b981; --warn:#f59e0b; --err:#ef4444; --brd:#1f2937 }
    html,body{height:100%}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; color:var(--ink);
      background: radial-gradient(1200px 600px at 10% -10%, rgba(34,211,238,.25), transparent 60%),
                  radial-gradient(900px 420px at 100% 0%, rgba(16,185,129,.15), transparent 55%),
                  linear-gradient(180deg,var(--bg1),var(--bg2))}
    .wrap{max-width:960px; margin:24px auto; padding:16px}
    .card{background:var(--card); border:1px solid var(--brd); border-radius:18px; padding:20px; box-shadow:0 8px 24px rgba(0,0,0,.25)}
    h1{margin:0 0 8px; font-size:24px}
    p.lead{margin:0 0 16px; color:var(--muted)}
    form{display:grid; grid-template-columns:1fr 1fr; gap:14px}
    .full{grid-column:1/-1}
    label{display:block; font-size:13px; color:var(--muted); margin:6px 0}
    input,select,textarea{width:100%; background:#0b1326; color:var(--ink); border:1px solid var(--brd); border-radius:12px; padding:10px 12px; outline:none}
    textarea{min-height:120px; resize:vertical}
    .row{display:flex; gap:10px; align-items:center}
    .hint{font-size:12px; color:var(--muted)}
    .error{color:var(--err); font-size:13px}
    .success{color:var(--ok); font-size:13px}
    .actions{display:flex; gap:10px; justify-content:flex-end}
    button{cursor:pointer; border:1px solid var(--brd); background:#0d1b2a; color:var(--ink); padding:10px 14px; border-radius:12px}
    button.primary{background:var(--accent); color:#03222a; border:none; font-weight:600}
    .divider{height:1px; background:var(--brd); margin:8px 0}
    .progress{height:6px; background:#0b1326; border:1px solid var(--brd); border-radius:999px; overflow:hidden}
    .bar{height:100%; width:0%}
    .topbar{display:flex; gap:10px; justify-content:space-between; align-items:center; position:relative}
    .close{position:absolute; right:0; top:0; transform:translate(8px,-8px); width:32px; height:32px; border-radius:999px; border:1px solid var(--brd); background:#0d1b2a; color:#e5e7eb; font-size:18px; line-height:30px; text-align:center; cursor:pointer}
    .lang{display:flex; gap:8px; align-items:center}
    .lang select{min-width:140px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="topbar">
        <div>
          <h1 id="t_title">Ä°lan OluÅŸtur</h1>
          <p id="t_sub" class="lead">PREMIUM: <strong>10 ilan</strong> + <strong>1 vitrin</strong>. FREE: <strong>5 ilan</strong>. TÃ¼m ilanlar <strong>30 gÃ¼n</strong> yayÄ±nda.</p>
        </div>
        <button id="closePanel" class="close" aria-label="Kapat">Ã—</button>
      </div>

      <div class="row" style="justify-content:space-between; align-items:center; margin:6px 0 4px">
        <div id="guard" class="hint">â€”</div>
        <div class="lang">
          <label id="t_lang" for="langSel" class="hint">Dil</label>
          <select id="langSel">
            <option value="tr">TÃ¼rkÃ§e</option>
            <option value="en">English</option>
            <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            <option value="de">Deutsch</option>
          </select>
        </div>
      </div>

      <div class="divider"></div>

      <form id="listingForm" novalidate>
        <div class="full">
          <label id="l_title">BaÅŸlÄ±k</label>
          <input id="title" placeholder="Ã–rn: El yapÄ±mÄ± Ã¶rgÃ¼ bebek" maxlength="80" required />
          <div class="hint" id="h_title">6â€“80 karakter</div>
        </div>
        <div class="full">
          <label id="l_description">AÃ§Ä±klama</label>
          <textarea id="description" placeholder="ÃœrÃ¼nÃ¼ detaylÄ± anlatÄ±n" maxlength="3000" required></textarea>
          <div class="hint" id="h_description">30â€“3000 karakter, uygunsuz iÃ§erik reddedilir.</div>
        </div>

        <div>
          <label id="l_category">Kategori</label>
          <select id="category" required></select>
        </div>
        <div>
          <label id="l_subcategory">Alt Kategori</label>
          <select id="subcategory" required disabled></select>
        </div>

        <div>
          <label id="l_province">Ä°l</label>
          <select id="province" required></select>
        </div>
        <div>
          <label id="l_district">Ä°lÃ§e</label>
          <input id="districtInput" placeholder="Ä°lÃ§enizi yazÄ±n" required />
        </div>

        <div>
          <label id="l_price">Fiyat (TL)</label>
          <input id="price" type="number" min="1" step="1" placeholder="Ã–rn: 350" required />
        </div>
        <div>
          <label id="l_stock">Stok</label>
          <select id="stock" required>
            <option value="var">Var</option>
            <option value="yok">Yok</option>
          </select>
        </div>

        <div class="full">
          <label id="l_prep">HazÄ±rlÄ±k SÃ¼resi</label>
          <input id="prep" placeholder="Ã–rn: 2â€“3 gÃ¼n" />
        </div>

        <div class="full">
          <label id="l_images">FotoÄŸraflar (en fazla 5)</label>
          <input id="images" type="file" accept="image/*" multiple />
          <div class="hint" id="h_images">JPG/PNG/WebP, en fazla 5 dosya.</div>
          <div class="progress" style="margin-top:8px"><div id="upBar" class="bar" style="background:var(--accent)"></div></div>
          <div id="upHint" class="hint">â€”</div>
        </div>

        <div class="full" style="display:flex; align-items:center; gap:10px">
          <input id="showcase" type="checkbox" />
          <label for="showcase" id="l_showcase">Vitrin (yalnÄ±zca PREMIUM)</label>
        </div>

        <div class="full actions">
          <button type="button" id="cancelBtn">Ä°ptal</button>
          <button type="submit" class="primary" id="b_submit">Ä°lana GÃ¶nder (Onaya)</button>
        </div>

        <div class="full">
          <div id="msg" class="hint"></div>
        </div>
      </form>
    </div>
  </div>

  <!-- ==== PROD: Firebase + Admin Onay AkÄ±ÅŸlÄ± ==== -->
  <script type="module">
    /* ---------------- Firebase CDN (v10) ---------------- */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, addDoc, collection, serverTimestamp, query, where, getCountFromServer } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
    import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-storage.js";

    /* ---------------- Proje Bilgileriniz ---------------- */
    const firebaseConfig = {
      apiKey: "AIzaSyCd9GjP6CDA8i4XByhXDHyESy-g_DHVwvQ",
      authDomain: "ureteneller-ecaac.firebaseapp.com",
      projectId: "ureteneller-ecaac",
      storageBucket: "ureteneller-ecaac.firebasestorage.app",
      messagingSenderId: "368042877151",
      appId: "1:368042877151:web:ee0879fc4717928079c96a",
      measurementId: "G-BJHKN8V4RQ"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);
    const st   = getStorage(app);

    /* ---------------- I18N (TR/EN/AR/DE) ---------------- */
    const i18n = {
      tr:{ title:"Ä°lan OluÅŸtur", sub:"PREMIUM: <strong>10 ilan</strong> + <strong>1 vitrin</strong>. FREE: <strong>5 ilan</strong>. TÃ¼m ilanlar <strong>30 gÃ¼n</strong> yayÄ±nda.", lang:"Dil",
        l_title:"BaÅŸlÄ±k", h_title:"6â€“80 karakter", l_description:"AÃ§Ä±klama", h_description:"30â€“3000 karakter, uygunsuz iÃ§erik reddedilir.", l_category:"Kategori", l_subcategory:"Alt Kategori", l_province:"Ä°l", l_district:"Ä°lÃ§e", l_price:"Fiyat (TL)", l_stock:"Stok", l_prep:"HazÄ±rlÄ±k SÃ¼resi", l_images:"FotoÄŸraflar (en fazla 5)", h_images:"JPG/PNG/WebP, en fazla 5 dosya.", l_showcase:"Vitrin (yalnÄ±zca PREMIUM)", b_submit:"Ä°lana GÃ¶nder (Onaya)", placeholders:{ title:"Ã–rn: El yapÄ±mÄ± Ã¶rgÃ¼ bebek", desc:"ÃœrÃ¼nÃ¼ detaylÄ± anlatÄ±n", district:"Ä°lÃ§enizi yazÄ±n", price:"Ã–rn: 350", prep:"Ã–rn: 2â€“3 gÃ¼n" }, stock:{var:"Var", yok:"Yok"}, errors:{ title:"BaÅŸlÄ±k en az 6 karakter olmalÄ±.", desc:"AÃ§Ä±klama en az 30 karakter olmalÄ±.", cat:"Kategori seÃ§iniz.", sub:"Alt kategori seÃ§iniz.", prov:"Ä°l seÃ§iniz.", dist:"Ä°lÃ§e yazÄ±nÄ±z.", price:"Fiyat 1 TL ve Ã¼zeri olmalÄ±.", files:"En fazla 5 fotoÄŸraf yÃ¼kleyebilirsiniz.", auth:"LÃ¼tfen giriÅŸ yapÄ±n.", filetype:"Sadece JPG/PNG/WebP kabul edilir." }, choose:"SeÃ§iniz", hi:"HoÅŸ geldiniz" },
      en:{ title:"Create Listing", sub:"PREMIUM: <strong>10 listings</strong> + <strong>1 showcase</strong>. FREE: <strong>5 listings</strong>. All listings stay live for <strong>30 days</strong>.", lang:"Language",
        l_title:"Title", h_title:"6â€“80 characters", l_description:"Description", h_description:"30â€“3000 characters; inappropriate content is rejected.", l_category:"Category", l_subcategory:"Subcategory", l_province:"Province", l_district:"District", l_price:"Price (TRY)", l_stock:"Stock", l_prep:"Preparation Time", l_images:"Photos (up to 5)", h_images:"JPG/PNG/WebP, up to 5 files.", l_showcase:"Showcase (PREMIUM only)", b_submit:"Submit for Review", placeholders:{ title:"e.g., Hand-knitted doll", desc:"Describe your product in detail", district:"Type your district", price:"e.g., 350", prep:"e.g., 2â€“3 days" }, stock:{var:"In stock", yok:"Out of stock"}, errors:{ title:"Title must be at least 6 characters.", desc:"Description must be at least 30 characters.", cat:"Select a category.", sub:"Select a subcategory.", prov:"Select a province.", dist:"Enter a district.", price:"Price must be â‰¥ 1.", files:"You can upload up to 5 photos.", auth:"Please sign in.", filetype:"Only JPG/PNG/WebP accepted." }, choose:"Select", hi:"Welcome" },
      ar:{ title:"Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø¹Ù„Ø§Ù†", sub:"Ø§Ù„Ù…Ù…ÙŠØ²: <strong>10 Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</strong> + <strong>1 ÙˆØ§Ø¬Ù‡Ø©</strong>. Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ: <strong>5 Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</strong>. ÙƒÙ„ Ø¥Ø¹Ù„Ø§Ù† ÙŠØ¨Ù‚Ù‰ <strong>30 ÙŠÙˆÙ…Ø§Ù‹</strong>.", lang:"Ø§Ù„Ù„ØºØ©",
        l_title:"Ø§Ù„Ø¹Ù†ÙˆØ§Ù†", h_title:"6â€“80 Ø­Ø±ÙØ§Ù‹", l_description:"Ø§Ù„ÙˆØµÙ", h_description:"30â€“3000 Ø­Ø±ÙØ§Ù‹Ø› ÙŠØªÙ… Ø±ÙØ¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ø§Ù„Ù…Ù„Ø§Ø¦Ù….", l_category:"Ø§Ù„ÙØ¦Ø©", l_subcategory:"Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©", l_province:"Ø§Ù„ÙˆÙ„Ø§ÙŠØ©", l_district:"Ø§Ù„Ù‚Ø¶Ø§Ø¡", l_price:"Ø§Ù„Ø³Ø¹Ø± (Ù„ÙŠØ±Ø©)", l_stock:"Ø§Ù„ØªÙˆÙÙ‘Ø±", l_prep:"Ù…Ø¯Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ±", l_images:"ØµÙˆØ± (Ø­ØªÙ‰ 5)", h_images:"JPG/PNG/WebP Ø­ØªÙ‰ 5 Ù…Ù„ÙØ§Øª.", l_showcase:"ÙˆØ§Ø¬Ù‡Ø© (Ù„Ù„Ù…Ù…ÙŠØ² ÙÙ‚Ø·)", b_submit:"Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©", placeholders:{ title:"Ù…Ø«Ø§Ù„: Ø¯Ù…ÙŠØ© Ù…Ø­Ø§ÙƒØ© ÙŠØ¯ÙˆÙŠØ§Ù‹", desc:"ØµÙ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ù„ØªÙØµÙŠÙ„", district:"Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ø¶Ø§Ø¡", price:"Ù…Ø«Ø§Ù„: 350", prep:"Ù…Ø«Ø§Ù„: 2â€“3 Ø£ÙŠØ§Ù…" }, stock:{var:"Ù…ØªÙˆÙØ±", yok:"ØºÙŠØ± Ù…ØªÙˆÙØ±"}, errors:{ title:"ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.", desc:"Ø§Ù„ÙˆØµÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 30 Ø­Ø±ÙØ§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.", cat:"Ø§Ø®ØªØ± ÙØ¦Ø©.", sub:"Ø§Ø®ØªØ± ÙØ¦Ø© ÙØ±Ø¹ÙŠØ©.", prov:"Ø§Ø®ØªØ± ÙˆÙ„Ø§ÙŠØ©.", dist:"Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚Ø¶Ø§Ø¡.", price:"Ø§Ù„Ø³Ø¹Ø± ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† â‰¥ 1.", files:"ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ Ø­ØªÙ‰ 5 ØµÙˆØ±.", auth:"ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.", filetype:"ÙŠÙÙ‚Ø¨Ù„ ÙÙ‚Ø· JPG/PNG/WebP." }, choose:"Ø§Ø®ØªØ±", hi:"Ù…Ø±Ø­Ø¨Ø§Ù‹" },
      de:{ title:"Anzeige erstellen", sub:"PREMIUM: <strong>10 Anzeigen</strong> + <strong>1 Schaufenster</strong>. FREE: <strong>5 Anzeigen</strong>. Jede Anzeige bleibt <strong>30 Tage</strong> online.", lang:"Sprache",
        l_title:"Titel", h_title:"6â€“80 Zeichen", l_description:"Beschreibung", h_description:"30â€“3000 Zeichen; unzulÃ¤ssiger Inhalt wird abgelehnt.", l_category:"Kategorie", l_subcategory:"Unterkategorie", l_province:"Provinz", l_district:"Bezirk", l_price:"Preis (TRY)", l_stock:"Bestand", l_prep:"Vorbereitungszeit", l_images:"Fotos (bis zu 5)", h_images:"JPG/PNG/WebP, bis zu 5 Dateien.", l_showcase:"Schaufenster (nur PREMIUM)", b_submit:"Zur PrÃ¼fung einreichen", placeholders:{ title:"z. B. Handgestrickte Puppe", desc:"Beschreiben Sie Ihr Produkt ausfÃ¼hrlich", district:"Bezirk eingeben", price:"z. B. 350", prep:"z. B. 2â€“3 Tage" }, stock:{var:"Auf Lager", yok:"Nicht vorrÃ¤tig"}, errors:{ title:"Titel muss mind. 6 Zeichen haben.", desc:"Beschreibung mind. 30 Zeichen.", cat:"Kategorie wÃ¤hlen.", sub:"Unterkategorie wÃ¤hlen.", prov:"Provinz wÃ¤hlen.", dist:"Bezirk eingeben.", price:"Preis muss â‰¥ 1 sein.", files:"Max. 5 Fotos.", auth:"Bitte anmelden.", filetype:"Nur JPG/PNG/WebP." }, choose:"WÃ¤hlen", hi:"Willkommen" }
    };

    /* ---------------- Kategoriler & 81 Ä°l ---------------- */
    const cats = [
      {id:'yemek', names:{tr:'ğŸ² Yemekler', en:'ğŸ² Meals', de:'ğŸ² Mahlzeiten', ar:'ğŸ² ÙˆØ¬Ø¨Ø§Øª'}, subs:[
        ['Ev yemekleri','Home-cooked','Hausmannskost','ÙˆØ¬Ø¨Ø§Øª Ù…Ù†Ø²Ù„ÙŠØ©'],
        ['BÃ¶rek-Ã§Ã¶rek','Savory pastries','Herzhaftes GebÃ¤ck','ÙØ·Ø§Ø¦Ø± Ù…Ø§Ù„Ø­Ø©'],
        ['Ã‡orba','Soup','Suppe','Ø´ÙˆØ±Ø¨Ø©'],
        ['ZeytinyaÄŸlÄ±','Olive-oil dishes','Gerichte mit OlivenÃ¶l','Ø£Ø·Ø¨Ø§Ù‚ Ø¨Ø²ÙŠØª Ø§Ù„Ø²ÙŠØªÙˆÙ†'],
        ['Pilav-makarna','Rice & pasta','Reis & Pasta','Ø£Ø±Ø² ÙˆÙ…Ø¹ÙƒØ±ÙˆÙ†Ø©'],
        ['Et-tavuk','Meat & chicken','Fleisch & Huhn','Ù„Ø­ÙˆÙ… ÙˆØ¯Ø¬Ø§Ø¬'],
        ['KahvaltÄ±lÄ±k','Breakfast items','FrÃ¼hstÃ¼ck','Ù…Ø£ÙƒÙˆÙ„Ø§Øª Ø§Ù„Ø¥ÙØ·Ø§Ø±'],
        ['Meze','Mezes','Vorspeisen','Ù…Ù‚Ø¨Ù„Ø§Øª'],
        ['DondurulmuÅŸ','Frozen','TiefgekÃ¼hlt','Ù…Ø¬Ù…Ø¯'],
        ['Ã‡ocuk Ã¶ÄŸÃ¼nleri','Kids meals','Kindergerichte','ÙˆØ¬Ø¨Ø§Øª Ø§Ù„Ø£Ø·ÙØ§Ù„'],
        ['Diyet/vegan/gf','Diet/Vegan/GF','DiÃ¤t/Vegan/GF','Ø­Ù…ÙŠØ©/Ù†Ø¨Ø§ØªÙŠ/Ø®Ø§Ù„Ù Ù…Ù† Ø§Ù„ØºÙ„ÙˆØªÙŠÙ†']
      ]},
      {id:'pasta', names:{tr:'ğŸ‚ Pasta & TatlÄ±', en:'ğŸ‚ Cakes & Sweets', de:'ğŸ‚ Torten & SÃ¼ÃŸes', ar:'ğŸ‚ ÙƒØ¹Ùƒ ÙˆØ­Ù„ÙˆÙŠØ§Øª'}, subs:[
        ['YaÅŸ pasta','Fresh cakes','Torten','ÙƒÙŠÙƒ Ø·Ø§Ø²Ø¬'],
        ['Kek-cupcake','Cakes & cupcakes','Kuchen & Cupcakes','ÙƒÙŠÙƒ ÙˆÙƒØ¨ ÙƒÙŠÙƒ'],
        ['Kurabiye','Cookies','Kekse','Ø¨Ø³ÙƒÙˆÙŠØª'],
        ['Åerbetli','Syrup desserts','Sirup-Desserts','Ø­Ù„ÙˆÙŠØ§Øª Ø´Ø±Ù‚ÙŠØ©'],
        ['SÃ¼tlÃ¼','Milky desserts','Milchige Desserts','Ø­Ù„ÙˆÙŠØ§Øª Ø¨Ø§Ù„Ø­Ù„ÙŠØ¨'],
        ['Cheesecake','Cheesecake','KÃ¤sekuchen','ØªØ´ÙŠØ²ÙƒÙŠÙƒ'],
        ['Diyet tatlÄ±','Diet desserts','DiÃ¤t-Desserts','Ø­Ù„ÙˆÙŠØ§Øª Ù„Ù„Ø­Ù…ÙŠØ©'],
        ['Ã‡ikolata/ÅŸekerleme','Chocolate/Candy','Schokolade/SÃ¼ÃŸwaren','Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©/Ø­Ù„ÙˆÙ‰'],
        ['DoÄŸum gÃ¼nÃ¼ setleri','Birthday sets','Geburtstags-Sets','Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯']
      ]},
      {id:'recel', names:{tr:'ğŸ«™ ReÃ§el â€¢ TurÅŸu â€¢ Sos', en:'ğŸ«™ Jams â€¢ Pickles â€¢ Sauces', de:'ğŸ«™ Marmelade â€¢ Eingelegtes â€¢ Saucen', ar:'ğŸ«™ Ù…Ø±Ø¨Ù‰ â€¢ Ù…Ø®Ù„Ù„Ø§Øª â€¢ ØµÙ„ØµØ§Øª'}, subs:[
        ['ReÃ§el-marmelat','Jam & marmalade','Marmelade','Ù…Ø±Ø¨Ù‰'],
        ['Pekmez','Molasses','Traubensirup','Ø¯Ø¨Ø³'],
        ['TurÅŸu','Pickles','Eingelegtes','Ù…Ø®Ù„Ù„'],
        ['Domates/biber sos','Tomato/pepper sauce','Tomaten/Paprika-Sauce','ØµÙ„ØµØ© Ø·Ù…Ø§Ø·Ù…/ÙÙ„ÙÙ„'],
        ['AcÄ± sos','Hot sauce','Scharfe SoÃŸe','ØµÙ„ØµØ© Ø­Ø§Ø±Ø©'],
        ['SalÃ§a','Paste','Tomatenmark','Ù…Ø¹Ø¬ÙˆÙ†'],
        ['Sirke','Vinegar','Essig','Ø®Ù„'],
        ['Konserve','Canned','Konserven','Ù…Ø¹Ù„Ø¨Ø§Øª']
      ]},
      {id:'yoresel', names:{tr:'ğŸŒ¾ YÃ¶resel / KÄ±ÅŸlÄ±k', en:'ğŸŒ¾ Local / Winter Prep', de:'ğŸŒ¾ Regional / Wintervorrat', ar:'ğŸŒ¾ Ù…Ø­Ù„ÙŠ / Ù…Ø¤ÙˆÙ†Ø© Ø§Ù„Ø´ØªØ§Ø¡'}, subs:[
        ['EriÅŸte','Homemade noodles','Hausgemachte Nudeln','Ø´Ø¹ÙŠØ±ÙŠØ© Ù…Ù†Ø²Ù„ÙŠØ©'],
        ['Tarhana','Tarhana','Tarhana','Ø·Ø±Ø®Ø§Ù†Ø©'],
        ['Yufka','Yufka','Yufka','ÙŠÙˆÙÙƒØ§'],
        ['MantÄ±','Manti dumplings','Manti-Teigtaschen','Ù…Ø§Ù†ØªÙŠ'],
        ['KurutulmuÅŸ sebze-meyve','Dried veg & fruit','Getrocknetes Obst/GemÃ¼se','Ù…Ø¬ÙÙØ§Øª'],
        ['SalÃ§a','Paste','Tomatenmark','Ù…Ø¹Ø¬ÙˆÙ†'],
        ['Sirke','Vinegar','Essig','Ø®Ù„'],
        ['Konserve','Canned','Konserven','Ù…Ø¹Ù„Ø¨Ø§Øª']
      ]},
      {id:'diyet', names:{tr:'ğŸ¥— Diyet / Vegan / Glutensiz', en:'ğŸ¥— Diet / Vegan / Gluten-Free', de:'ğŸ¥— DiÃ¤t / Vegan / Glutenfrei', ar:'ğŸ¥— Ø­Ù…ÙŠØ© / Ù†Ø¨Ø§ØªÙŠ / Ø®Ø§Ù„Ù Ù…Ù† Ø§Ù„ØºÙ„ÙˆØªÙŠÙ†'}, subs:[
        ['Fit tabaklar','Fit plates','Fitness-Teller','Ø£Ø·Ø¨Ø§Ù‚ ØµØ­ÙŠØ©'],
        ['Vegan yemekler','Vegan meals','Vegane Gerichte','Ø£Ø·Ø¨Ø§Ù‚ Ù†Ø¨Ø§ØªÙŠØ©'],
        ['GF unlu mamuller','GF bakery','Glutenfreie Backwaren','Ù…Ø®Ø¨ÙˆØ²Ø§Øª Ø®Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„ØºÙ„ÙˆØªÙŠÙ†'],
        ['Åekersiz tatlÄ±','Sugar-free desserts','Zuckerfreie Desserts','Ø­Ù„ÙˆÙŠØ§Øª Ø¨Ø¯ÙˆÙ† Ø³ÙƒØ±'],
        ['Keto Ã¼rÃ¼n','Keto products','Keto-Produkte','Ù…Ù†ØªØ¬Ø§Øª ÙƒÙŠØªÙˆ'],
        ['Protein atÄ±ÅŸtÄ±rmalÄ±k','Protein snacks','Protein-Snacks','ÙˆØ¬Ø¨Ø§Øª Ø¨Ø±ÙˆØªÙŠÙ†ÙŠØ©']
      ]},
      {id:'taki', names:{tr:'ğŸ’ TakÄ±', en:'ğŸ’ Jewelry', de:'ğŸ’ Schmuck', ar:'ğŸ’ Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª'}, subs:[
        ['Bileklik','Bracelet','Armband','Ø³ÙˆØ§Ø±'],
        ['Kolye','Necklace','Halskette','Ø¹Ù‚Ø¯'],
        ['KÃ¼pe','Earrings','Ohrringe','Ø£Ù‚Ø±Ø§Ø·'],
        ['YÃ¼zÃ¼k','Ring','Ring','Ø®Ø§ØªÙ…'],
        ['Halhal','Anklet','FuÃŸkettchen','Ø®Ù„Ø®Ø§Ù„'],
        ['BroÅŸ','Brooch','Brosche','Ø¨Ø±ÙˆØ´'],
        ['Setler','Sets','Sets','Ø·Ù‚Ù…'],
        ['Ä°simli/kiÅŸiye Ã¶zel','Personalized','Personalisierte','Ù…Ø®ØµØµ Ø¨Ø§Ù„Ø§Ø³Ù…'],
        ['Makrome','Macrame','Makramee','Ù…ÙƒØ±Ù…ÙŠØ©'],
        ['DoÄŸal taÅŸ','Gemstone','Edelstein','Ø£Ø­Ø¬Ø§Ø± Ø·Ø¨ÙŠØ¹ÙŠØ©'],
        ['ReÃ§ine','Resin','Harz','Ø±ÙŠØ²Ù†'],
        ['Tel sarma','Wire wrap','Drahtwickel','Ø³Ù„Ùƒ Ù…Ù„ØªÙ']
      ]},
      {id:'bebek', names:{tr:'ğŸ‘¶ Bebek & Ã‡ocuk', en:'ğŸ‘¶ Baby & Kids', de:'ğŸ‘¶ Baby & Kinder', ar:'ğŸ‘¶ Ø±Ø¶Ù‘Ø¹ ÙˆØ£Ø·ÙØ§Ù„'}, subs:[
        ['Hayvan/bebek figÃ¼rleri','Animal/baby figures','Tier/Baby-Figuren','Ù…Ø¬Ø³Ù…Ø§Øª'],
        ['Ã‡Ä±ngÄ±rak','Rattle','Rassel','Ø®Ø´Ø®ÙŠØ´Ø©'],
        ['DiÅŸ kaÅŸÄ±yÄ±cÄ± Ã¶rgÃ¼','Teething knit','BeiÃŸring-HÃ¤kel','Ø¹Ø¶Ø§Ø¶Ø© Ù…Ø­Ø§ÙƒØ©'],
        ['Bez oyuncak/kitap','Cloth toy/book','Stoffspielzeug/Buch','Ù„Ø¹Ø¨Ø©/ÙƒØªØ§Ø¨ Ù‚Ù…Ø§Ø´ÙŠ'],
        ['Montessori oyuncak','Montessori toys','Montessori-Spielzeug','Ø£Ù„Ø¹Ø§Ø¨ Ù…Ù†ØªØ³ÙˆØ±ÙŠ'],
        ['Setler','Sets','Sets','Ø£Ø·Ù‚Ù…'],
        ['Ã–rgÃ¼ patik-bere','Knit booties-beanie','GehÃ¤kelte SchÃ¼hchen & MÃ¼tze','Ù‚Ø¨Ø¹Ø§Øª ÙˆØ¬ÙˆØ§Ø±Ø¨ Ù…Ø­Ø§ÙƒØ©'],
        ['Bebek battaniyesi','Baby blanket','Babydecke','Ø¨Ø·Ø§Ù†ÙŠØ©'],
        ['Ã–nlÃ¼k-aÄŸÄ±z bezi','Bib/burp cloth','LÃ¤tzchen/Spucktuch','Ù…Ø±ÙŠÙ„Ø©/Ù…Ù†Ø¯ÙŠÙ„'],
        ['Lohusa seti','Maternity set','Wochenbett-Set','Ø¹Ø¯Ø© Ù†ÙØ§Ø³'],
        ['SaÃ§ aksesuarÄ±','Hair accessory','Haaraccessoire','Ø§ÙƒØ³Ø³ÙˆØ§Ø± Ø´Ø¹Ø±'],
        ['El emeÄŸi kÄ±yafet','Handmade clothing','Handgemachte Kleidung','Ù…Ù„Ø§Ø¨Ø³ ÙŠØ¯ÙˆÙŠØ©']
      ]},
      {id:'orgu', names:{tr:'ğŸ§¶ Ã–rgÃ¼ / Triko', en:'ğŸ§¶ Knitting / Crochet', de:'ğŸ§¶ Strick / HÃ¤keln', ar:'ğŸ§¶ Ø­ÙŠØ§ÙƒØ© / ÙƒØ±ÙˆØ´ÙŠÙ‡'}, subs:[
        ['HÄ±rka','Cardigan','Strickjacke','ÙƒØ§Ø±Ø¯ÙŠØºØ§Ù†'],
        ['Kazak','Sweater','Pullover','ÙƒÙ†Ø²Ø©'],
        ['AtkÄ±-bere','Scarf & beanie','Schal & MÃ¼tze','ÙˆØ´Ø§Ø­ ÙˆÙ‚Ø¨Ø¹Ø©'],
        ['PanÃ§o','Poncho','Poncho','Ø¨ÙˆÙ†Ø´Ùˆ'],
        ['Åal','Shawl','Schal','Ø´Ø§Ù„'],
        ['Ã‡orap','Socks','Socken','Ø¬ÙˆØ§Ø±Ø¨'],
        ['Lif takÄ±mÄ±','Bath set','Badeset','Ø·Ù‚Ù… Ù„ÙŠÙ'],
        ['Bebek takÄ±mÄ±','Baby set','Baby-Set','Ø·Ù‚Ù… Ø£Ø·ÙØ§Ù„'],
        ['Yelek','Vest','Weste','ØµØ¯ÙŠØ±ÙŠ'],
        ['KÄ±rlent-Ã¶rtÃ¼','Cushion/cover','Kissen/Decke','ÙˆØ³Ø§Ø¯Ø©/ØºØ·Ø§Ø¡']
      ]},
      {id:'dikis', names:{tr:'âœ‚ï¸ DikiÅŸ / Terzilik', en:'âœ‚ï¸ Sewing / Tailoring', de:'âœ‚ï¸ NÃ¤hen / Schneiderei', ar:'âœ‚ï¸ Ø®ÙŠØ§Ø·Ø© / ØªÙØµÙŠÙ„'}, subs:[
        ['PaÃ§a/onarÄ±m','Hem/repair','Saum/Reparatur','Ø«Ù†ÙŠ/ØªØµÙ„ÙŠØ­'],
        ['Fermuar deÄŸiÅŸimi','Zipper change','ReiÃŸverschluss-Wechsel','ØªØ¨Ø¯ÙŠÙ„ Ø³Ø­Ø§Ø¨'],
        ['Perde dikiÅŸi','Curtain sewing','Vorhang-NÃ¤hen','Ø®ÙŠØ§Ø·Ø© Ø³ØªØ§Ø¦Ø±'],
        ['Nevresim-yastÄ±k','Bedding & pillows','BettwÃ¤sche/Kissen','Ù…ÙØ§Ø±Ø´ ÙˆÙˆØ³Ø§Ø¦Ø¯'],
        ['Masa Ã¶rtÃ¼sÃ¼','Tablecloth','Tischtuch','Ù…ÙØ±Ø´ Ø·Ø§ÙˆÙ„Ø©'],
        ['Ã–zel dikim','Custom tailoring','MaÃŸanfertigung','ØªÙØµÙŠÙ„ Ø®Ø§Øµ'],
        ['KostÃ¼m','Costume','KostÃ¼m','Ø²ÙŠÙ‘']
      ]},
      {id:'makrome', names:{tr:'ğŸ§µ Makrome & Dekor', en:'ğŸ§µ MacramÃ© & Decor', de:'ğŸ§µ Makramee & Deko', ar:'ğŸ§µ Ù…ÙƒØ±Ù…ÙŠØ© ÙˆØ¯ÙŠÙƒÙˆØ±'}, subs:[
        ['Duvar sÃ¼sÃ¼','Wall hanging','Wandbehang','Ø¯ÙŠÙƒÙˆØ± Ø¬Ø¯Ø§Ø±ÙŠ'],
        ['SaksÄ± askÄ±sÄ±','Plant hanger','PflanzenhÃ¤nger','Ø­Ø§Ù…Ù„ Ù†Ø¨Ø§ØªØ§Øª'],
        ['AnahtarlÄ±k','Keychain','SchlÃ¼sselanhÃ¤nger','Ù…ÙŠØ¯Ø§Ù„ÙŠØ©'],
        ['Avize','Chandelier','Deckenleuchte','Ø«Ø±ÙŠØ§'],
        ['Amerikan servis/runner','Placemat/runner','Tischset/Runner','Ù…ÙØ±Ø´ Ø³ÙØ±Ø©'],
        ['Sepet','Basket','Korb','Ø³Ù„Ø©'],
        ['Raf/duvar dekoru','Shelf/wall decor','Regal/Wanddeko','Ø±Ù/Ø¯ÙŠÙƒÙˆØ±']
      ]},
      {id:'evdekor', names:{tr:'ğŸ  Ev Dekor & Aksesuar', en:'ğŸ  Home Decor & Accessories', de:'ğŸ  Wohndeko & Accessoires', ar:'ğŸ  Ø¯ÙŠÙƒÙˆØ± Ø§Ù„Ù…Ù†Ø²Ù„ ÙˆØ¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª'}, subs:[
        ['KeÃ§e iÅŸleri','Felt crafts','Filzarbeiten','Ø£Ø¹Ù…Ø§Ù„ Ù„Ø¨Ù‘Ø§Ø¯'],
        ['KÄ±rlent','Cushion','Kissen','ÙˆØ³Ø§Ø¯Ø©'],
        ['KapÄ± sÃ¼sÃ¼','Door ornament','TÃ¼rkranz','Ø²ÙŠÙ†Ø© Ø¨Ø§Ø¨'],
        ['Tepsi sÃ¼sleme','Tray decoration','Tablett-Deko','ØªØ²ÙŠÙŠÙ† ØµÙŠÙ†ÙŠØ©'],
        ['Ã‡erÃ§eve','Frame','Rahmen','Ø¥Ø·Ø§Ø±'],
        ['RÃ¼ya kapanÄ±','Dreamcatcher','TraumfÃ¤nger','ØµØ§Ø¦Ø¯ Ø£Ø­Ù„Ø§Ù…'],
        ['Tablo','Tableau','Bild','Ù„ÙˆØ­Ø©']
      ]},
      {id:'mum', names:{tr:'ğŸ•¯ï¸ Mum & Kokulu ÃœrÃ¼nler', en:'ğŸ•¯ï¸ Candles & Fragranced', de:'ğŸ•¯ï¸ Kerzen & Duft', ar:'ğŸ•¯ï¸ Ø´Ù…ÙˆØ¹ ÙˆÙ…Ù†ØªØ¬Ø§Øª Ø¹Ø·Ø±ÙŠØ©'}, subs:[
        ['Soya/balmumu mum','Soy/beeswax candle','Soja/Bienenwachs-Kerze','Ø´Ù…ÙˆØ¹ ØµÙˆÙŠØ§/Ø´Ù…Ø¹ Ø§Ù„Ø¹Ø³Ù„'],
        ['Kokulu taÅŸ','Scented stone','Duftstein','Ø­Ø¬Ø± Ù…Ø¹Ø·Ø±'],
        ['Oda spreyi','Room spray','Raumspray','Ù…Ø¹Ø·Ø± Ø¬Ùˆ'],
        ['TÃ¼tsÃ¼','Incense','RÃ¤ucherwerk','Ø¨Ø®ÙˆØ±'],
        ['Jel mum','Gel candle','Gelkerze','Ø´Ù…Ø¹Ø© Ø¬Ù„'],
        ['Hediye seti','Gift set','Geschenkset','Ø·Ù‚Ù… Ù‡Ø¯Ø§ÙŠØ§']
      ]},
      {id:'sabun', names:{tr:'ğŸ§¼ DoÄŸal Sabun & Kozmetik', en:'ğŸ§¼ Natural Soap & Cosmetics', de:'ğŸ§¼ NatÃ¼rliche Seife & Kosmetik', ar:'ğŸ§¼ ØµØ§Ø¨ÙˆÙ† Ø·Ø¨ÙŠØ¹ÙŠ ÙˆÙ…Ø³ØªØ­Ø¶Ø±Ø§Øª ØªØ¬Ù…ÙŠÙ„'}, subs:[
        ['ZeytinyaÄŸlÄ± sabun','Olive-oil soap','OlivenÃ¶lseife','ØµØ§Ø¨ÙˆÙ† Ø²ÙŠØª Ø²ÙŠØªÙˆÙ†'],
        ['Bitkisel sabunlar','Herbal soaps','KrÃ¤uterseifen','ØµØ§Ø¨ÙˆÙ† Ø¹Ø´Ø¨ÙŠ'],
        ['KatÄ± ÅŸampuan','Solid shampoo','Festes Shampoo','Ø´Ø§Ù…Ø¨Ùˆ ØµÙ„Ø¨'],
        ['Dudak balmÄ±','Lip balm','Lippenbalsam','Ø¨Ù„Ø³Ù… Ø´ÙØ§Ù‡'],
        ['Krem/merhem','Cream/ointment','Creme/Salbe','ÙƒØ±ÙŠÙ…/Ù…Ø±Ù‡Ù…'],
        ['Banyo tuzu','Bath salt','Badesalz','Ù…Ù„Ø­ Ø§Ù„Ø§Ø³ØªØ­Ù…Ø§Ù…'],
        ['Lavanta kesesi','Lavender sachet','LavendelsÃ¤ckchen','ÙƒÙŠØ³ Ù„Ø§ÙÙ†Ø¯Ø±']
      ]},
      {id:'oyuncak', names:{tr:'ğŸ§¸ Amigurumi & Oyuncak (dekoratif)', en:'ğŸ§¸ Amigurumi & Decorative Toys', de:'ğŸ§¸ Amigurumi & Deko-Spielzeug', ar:'ğŸ§¸ Ø£Ù…ÙŠØ¬ÙˆØ±ÙˆÙ…ÙŠ ÙˆØ£Ù„Ø¹Ø§Ø¨ Ø¯ÙŠÙƒÙˆØ±ÙŠØ©'}, subs:[
        ['AnahtarlÄ±k','Keychain','SchlÃ¼sselanhÃ¤nger','Ù…ÙŠØ¯Ø§Ù„ÙŠØ©'],
        ['Magnet','Magnet','Magnet','Ù…ØºÙ†Ø§Ø·ÙŠØ³'],
        ['Koleksiyon figÃ¼rÃ¼','Collectible figure','Sammelfigur','Ù…Ø¬Ø³Ù‘Ù… Ù…Ø¬Ù…ÙˆØ¹Ø§Øª'],
        ['Dekor bebek/karakter','Decor doll/character','Deko-Puppe/Figur','Ø¯Ù…ÙŠØ©/Ø´Ø®ØµÙŠØ© Ø¯ÙŠÙƒÙˆØ±']
      ]}
    ];

    const provinces = ['Adana','AdÄ±yaman','Afyonkarahisar','AÄŸrÄ±','Amasya','Ankara','Antalya','Artvin','AydÄ±n','BalÄ±kesir','BartÄ±n','Batman','Bayburt','Bilecik','BingÃ¶l','Bitlis','Bolu','Burdur','Bursa','Ã‡anakkale','Ã‡ankÄ±rÄ±','Ã‡orum','Denizli','DiyarbakÄ±r','DÃ¼zce','Edirne','ElazÄ±ÄŸ','Erzincan','Erzurum','EskiÅŸehir','Gaziantep','Giresun','GÃ¼mÃ¼ÅŸhane','Hakkari','Hatay','IÄŸdÄ±r','Isparta','Ä°stanbul','Ä°zmir','KahramanmaraÅŸ','KarabÃ¼k','Karaman','Kars','Kastamonu','Kayseri','KÄ±rÄ±kkale','KÄ±rklareli','KÄ±rÅŸehir','Kilis','Kocaeli','Konya','KÃ¼tahya','Malatya','Manisa','Mardin','Mersin','MuÄŸla','MuÅŸ','NevÅŸehir','NiÄŸde','Ordu','Osmaniye','Rize','Sakarya','Samsun','ÅanlÄ±urfa','Siirt','Sinop','Sivas','ÅÄ±rnak','TekirdaÄŸ','Tokat','Trabzon','Tunceli','UÅŸak','Van','Yalova','Yozgat','Zonguldak'];

    /* ---------------- Dil / UI kurulum ---------------- */
    const langSel = document.getElementById('langSel');
    const nameIdx = { tr:0, en:1, de:2, ar:3 };

    function rebuildCategories(lng, choose){
      const idx = nameIdx[lng]??0;
      const selCat = document.getElementById('category');
      const selSub = document.getElementById('subcategory');
      selCat.innerHTML = `<option value="" disabled selected>${choose}</option>` + cats.map(c=>`<option value="${c.id}">${c.names[lng]||c.names.tr}</option>`).join('');
      selSub.disabled = true; selSub.innerHTML = `<option value="" disabled selected>${choose}</option>`;
      selCat.onchange = ()=>{
        const c = cats.find(x=>x.id===selCat.value);
        selSub.disabled = !c;
        selSub.innerHTML = `<option value="" disabled selected>${choose}</option>` + (c? c.subs.map(s=>`<option value="${s[0]}">${s[idx]||s[0]}</option>`).join('') : '');
      };
    }
    function fillProvinces(choose){
      const selProv = document.getElementById('province');
      selProv.innerHTML = `<option value="" disabled selected>${choose}</option>` + provinces.map(p=>`<option value="${p}">${p}</option>`).join('');
    }
    function setLang(lng){
      const t = i18n[lng]||i18n.tr;
      document.documentElement.lang = lng;
      document.documentElement.dir = (lng==='ar')?'rtl':'ltr';
      document.getElementById('t_title').textContent = t.title;
      document.getElementById('t_sub').innerHTML = t.sub;
      document.getElementById('t_lang').textContent = t.lang;
      document.getElementById('l_title').textContent = t.l_title;
      document.getElementById('h_title').textContent = t.h_title;
      document.getElementById('l_description').textContent = t.l_description;
      document.getElementById('h_description').textContent = t.h_description;
      document.getElementById('l_category').textContent = t.l_category;
      document.getElementById('l_subcategory').textContent = t.l_subcategory;
      document.getElementById('l_province').textContent = t.l_province;
      document.getElementById('l_district').textContent = t.l_district;
      document.getElementById('l_price').textContent = t.l_price;
      document.getElementById('l_stock').textContent = t.l_stock;
      document.getElementById('l_prep').textContent = t.l_prep;
      document.getElementById('l_images').textContent = t.l_images;
      document.getElementById('h_images').textContent = t.h_images;
      document.getElementById('l_showcase').textContent = t.l_showcase;
      document.getElementById('b_submit').textContent = t.b_submit;
      document.getElementById('title').placeholder = t.placeholders.title;
      document.getElementById('description').placeholder = t.placeholders.desc;
      document.getElementById('districtInput').placeholder = t.placeholders.district;
      document.getElementById('price').placeholder = t.placeholders.price;
      document.getElementById('prep').placeholder = t.placeholders.prep;
      const stock = document.getElementById('stock');
      stock.options[0].textContent = t.stock.var; stock.options[1].textContent = t.stock.yok;
      rebuildCategories(lng, t.choose); fillProvinces(t.choose);
      window.__t = t;
    }
    langSel.addEventListener('change', ()=> setLang(langSel.value));
    langSel.value='tr'; setLang('tr');

    /* ---------------- YardÄ±mcÄ±lar ---------------- */
    const guard = document.getElementById('guard');
    const form  = document.getElementById('listingForm');
    const upBar = document.getElementById('upBar');
    const upHint= document.getElementById('upHint');
    const msgEl = document.getElementById('msg');

    function trim(s){ return (s||"").trim(); }

    function validate(){
      const t = window.__t||i18n.tr;
      const title = trim(document.getElementById('title').value);
      const desc  = trim(document.getElementById('description').value);
      const cat   = document.getElementById('category').value;
      const sub   = document.getElementById('subcategory').value;
      const prov  = document.getElementById('province').value;
      const dist  = trim(document.getElementById('districtInput').value);
      const price = Number(document.getElementById('price').value||0);
      const files = document.getElementById('images').files;
      if(title.length<6) throw new Error(t.errors.title);
      if(desc.length<30) throw new Error(t.errors.desc);
      if(!cat) throw new Error(t.errors.cat);
      if(!sub) throw new Error(t.errors.sub);
      if(!prov) throw new Error(t.errors.prov);
      if(!dist) throw new Error(t.errors.dist);
      if(!(price>=1)) throw new Error(t.errors.price);
      if(files.length>5) throw new Error(t.errors.files);
      for(const f of files){ if(!/image\/(jpeg|png|webp)/.test(f.type)) throw new Error(t.errors.filetype); }
    }

    async function uploadImages(uid, listingId, files){
      if(!files || files.length===0) return [];
      const max = Math.min(files.length, 5);
      const urls = [];
      for(let i=0;i<max;i++){
        const f = files[i];
        const path = `listings/${uid}/${listingId}/img_${i+1}`;
        const r = ref(st, path);
        const task = uploadBytesResumable(r, f, { contentType: f.type });
        await new Promise((resolve,reject)=>{
          task.on('state_changed', (s)=>{
            const p = Math.round((s.bytesTransferred/s.totalBytes)*100);
            upBar.style.width = p+'%'; upHint.textContent = `${p}%`;
          }, reject, resolve);
        });
        const url = await getDownloadURL(task.snapshot.ref);
        urls.push(url);
      }
      upHint.textContent = 'OK';
      return urls;
    }

    async function fetchPlan(uid){
      const snap = await getDoc(doc(db,'users',uid));
      if(!snap.exists()) return { plan:'FREE', hasShowcase:false };
      const d = snap.data(); return { plan: d.plan||'FREE', hasShowcase: !!d.hasShowcase };
    }
    async function countActive(uid){
      const q = query(collection(db,'listings'), where('sellerUid','==',uid), where('status','==','active'));
      const agg = await getCountFromServer(q); return agg.data().count||0;
    }

    /* ---------------- Auth Guard ---------------- */
    onAuthStateChanged(auth, async (user)=>{
      if(!user){
        guard.innerHTML = 'LÃ¼tfen giriÅŸ yapÄ±n';
        // GiriÅŸ sayfanÄ±z buysa:
        window.location.href = '/docs/auth.html';
        return;
      }
      const t = window.__t||i18n.tr;
      guard.innerHTML = `${t.hi}, ${user.email||user.uid} <button id="btnOut" style="margin-left:10px">Ã‡Ä±kÄ±ÅŸ</button>`;
      const btnOut = document.getElementById('btnOut');
      if(btnOut){ btnOut.onclick = ()=> signOut(auth); }
    });

    /* ---------------- Submit -> Firestore (pending) ---------------- */
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const t = window.__t || i18n.tr;
      const user = auth.currentUser;
      msgEl.className='hint'; msgEl.textContent='';

      try{
        if(!user){ msgEl.className='error'; msgEl.textContent=t.errors.auth || 'LÃ¼tfen giriÅŸ yapÄ±n.'; return; }

        validate();

        // Plan limiti
        const { plan } = await fetchPlan(user.uid);
        const active = await countActive(user.uid);
        const limit  = (plan==='PREMIUM')?10:5;
        if(active>=limit) throw new Error('Plan limitine ulaÅŸÄ±ldÄ±.');

        // Showcase kontrol (PREMIUM deÄŸilse kapat)
        const isShowcaseChecked = document.getElementById('showcase').checked;
        const isShowcase = (plan==='PREMIUM') ? isShowcaseChecked : false;

        // Temel alanlar
        const base = {
          sellerUid: user.uid,
          title: trim(document.getElementById('title').value),
          description: trim(document.getElementById('description').value),
          categoryId: document.getElementById('category').value,
          subcategoryId: document.getElementById('subcategory').value,
          provinceCode: document.getElementById('province').value,
          districtText: trim(document.getElementById('districtInput').value),
          priceTl: Number(document.getElementById('price').value),
          inStock: document.getElementById('stock').value==='var',
          prepTimeText: trim(document.getElementById('prep').value),
          images: [],
          isShowcase,
          status:'pending',
          createdAt: serverTimestamp(),
          approvedAt: null,
          expiresAt: new Date(Date.now()+1000*60*60*24*30), // 30 gÃ¼n
          views:0, favorites:0
        };

        // 1) Ä°lanÄ± oluÅŸtur (pending)
        const created = await addDoc(collection(db,'listings'), base);

        // 2) GÃ¶rselleri (varsa) yÃ¼kle ve merge et
        const files = document.getElementById('images').files;
        const urls = await uploadImages(user.uid, created.id, files);
        if(urls.length){
          await setDoc(doc(db,'listings', created.id), { images: urls }, { merge:true });
        }

        // 3) Mesaj
        msgEl.className='success';
        msgEl.textContent = 'GÃ¶nderildi. Admin onayÄ±ndan sonra yayÄ±nlanacaktÄ±r.';
        setTimeout(()=>{ form.reset(); upBar.style.width='0%'; upHint.textContent='â€”'; }, 800);

      }catch(err){
        msgEl.className='error';
        msgEl.textContent = err?.message || String(err);
      }
    });

    /* ---------------- DiÄŸer UI olaylarÄ± ---------------- */
    document.getElementById('cancelBtn').addEventListener('click', ()=> form.reset());
    document.getElementById('closePanel').addEventListener('click', ()=> { window.location.href = '/docs/index.html'; });

  </script>

  <!-- ==== Basit Ã–n-YÃ¼kleme: Dil, Kategori, Ä°l (fallback iÃ§in tekrar) ==== -->
  <script>
    // i18n â€“ bu blok, Ã¼stteki type="module" baÅŸarÄ±lÄ± olsa da dil/ilk yÃ¼kleme iÃ§in gÃ¼venli fallback.
    // (AynÄ± yapÄ± Ã¼stte tekrarlandÄ±ÄŸÄ± iÃ§in burada yalÄ±n halde tutuyoruz)
    const i18nLite = {
      tr:{ lang:"Dil", choose:"SeÃ§iniz", l_title:"BaÅŸlÄ±k", h_title:"6â€“80 karakter", l_description:"AÃ§Ä±klama",
           h_description:"30â€“3000 karakter, uygunsuz iÃ§erik reddedilir.", l_category:"Kategori", l_subcategory:"Alt Kategori",
           l_province:"Ä°l", l_district:"Ä°lÃ§e", l_price:"Fiyat (TL)", l_stock:"Stok", l_prep:"HazÄ±rlÄ±k SÃ¼resi",
           l_images:"FotoÄŸraflar (en fazla 5)", h_images:"JPG/PNG/WebP, en fazla 5 dosya.", l_showcase:"Vitrin (yalnÄ±zca PREMIUM)",
           b_submit:"Ä°lana GÃ¶nder (Onaya)", placeholders:{ title:"Ã–rn: El yapÄ±mÄ± Ã¶rgÃ¼ bebek", desc:"ÃœrÃ¼nÃ¼ detaylÄ± anlatÄ±n", district:"Ä°lÃ§enizi yazÄ±n", price:"Ã–rn: 350", prep:"Ã–rn: 2â€“3 gÃ¼n" }, stock:{var:"Var", yok:"Yok"}
      }
    };
    // BaÅŸlangÄ±Ã§ metinleri (ilk boyama)
    document.getElementById('t_lang').textContent = i18nLite.tr.lang;
    document.getElementById('l_title').textContent = i18nLite.tr.l_title;
    document.getElementById('h_title').textContent = i18nLite.tr.h_title;
    document.getElementById('l_description').textContent = i18nLite.tr.l_description;
    document.getElementById('h_description').textContent = i18nLite.tr.h_description;
    document.getElementById('l_category').textContent = i18nLite.tr.l_category;
    document.getElementById('l_subcategory').textContent = i18nLite.tr.l_subcategory;
    document.getElementById('l_province').textContent = i18nLite.tr.l_province;
    document.getElementById('l_district').textContent = i18nLite.tr.l_district;
    document.getElementById('l_price').textContent = i18nLite.tr.l_price;
    document.getElementById('l_stock').textContent = i18nLite.tr.l_stock;
    document.getElementById('l_prep').textContent = i18nLite.tr.l_prep;
    document.getElementById('l_images').textContent = i18nLite.tr.l_images;
    document.getElementById('h_images').textContent = i18nLite.tr.h_images;
    document.getElementById('l_showcase').textContent = i18nLite.tr.l_showcase;
    document.getElementById('b_submit').textContent = i18nLite.tr.b_submit;
    document.getElementById('title').placeholder = i18nLite.tr.placeholders.title;
    document.getElementById('description').placeholder = i18nLite.tr.placeholders.desc;
    document.getElementById('districtInput').placeholder = i18nLite.tr.placeholders.district;
    document.getElementById('price').placeholder = i18nLite.tr.placeholders.price;
    document.getElementById('prep').placeholder = i18nLite.tr.placeholders.prep;

    // Guard baÅŸlangÄ±Ã§ mesajÄ±
    document.getElementById('guard').textContent = 'GiriÅŸ kontrol ediliyorâ€¦';
  </script>
</body>
</html>
