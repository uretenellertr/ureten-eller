(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{7953:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return t(1430)}])},1430:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return h}});var a=t(5893),i=t(645),n=t.n(i),r=t(7294),l=t(9008),d=t.n(l),c=t(4941);let o=null,x=e=>e?new Date(e).toLocaleString():"",u=e=>e?"Evet":"Hayır";function h(){let e=function(){if(o)return o;let e="https://krmjbjfwmnhzfhnrswgg.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtybWpiamZ3bW5oemZobnJzd2dnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3NjQ2NjYsImV4cCI6MjA3NTM0MDY2Nn0.cuM0AjBKOND7Q95Zjyp8jX9QoLI51OFfq4uJRkQmfM4";return e&&s?o=(0,c.eI)(e,s):null}(),[s,t]=(0,r.useState)(null),[i,l]=(0,r.useState)(null),[x,u]=(0,r.useState)(!0),[h,y]=(0,r.useState)("inbox"),[w,k]=(0,r.useState)(""),_=(0,r.useRef)(null),[v,N]=(0,r.useState)({pending:0,inbox:0,complaints:0}),C=(0,r.useRef)(v);(0,r.useEffect)(()=>{let s=!0;return(async()=>{try{if(!e){k("Supabase yapılandırması eksik."),u(!1);return}let{data:{user:a}}=await e.auth.getUser();if(!s)return;if(!a){k("\xd6nce giriş yapın."),u(!1);return}t(a);let{data:i,error:n}=await e.from("users").select("role").eq("auth_user_id",a.id).single();if(n){k("Kullanıcı rol\xfc okunamadı."),u(!1);return}l((null==i?void 0:i.role)||null)}catch(e){k((null==e?void 0:e.message)||"Hata")}finally{s&&u(!1)}})(),()=>{s=!1}},[e]);let D=!x&&"admin"!==i;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(d(),{children:[(0,a.jsx)("title",{className:"jsx-539ca2085833774d",children:"Admin – \xdcreten Eller"}),(0,a.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1",className:"jsx-539ca2085833774d"})]}),(0,a.jsx)("audio",{ref:_,src:"/notify.wav",preload:"auto",className:"jsx-539ca2085833774d"}),(0,a.jsxs)("div",{className:"jsx-539ca2085833774d admin",children:[(0,a.jsxs)("aside",{className:"jsx-539ca2085833774d side",children:[(0,a.jsxs)("div",{className:"jsx-539ca2085833774d brand",children:[(0,a.jsx)("img",{src:"/logo.png",width:"28",height:"28",alt:"logo",className:"jsx-539ca2085833774d"}),(0,a.jsx)("b",{className:"jsx-539ca2085833774d",children:"Y\xf6netim"})]}),(0,a.jsxs)("nav",{className:"jsx-539ca2085833774d menu",children:[(0,a.jsx)("button",{onClick:()=>y("inbox"),className:"jsx-539ca2085833774d "+(("inbox"===h?"on":"")||""),children:"\uD83D\uDCAC Mesajlar"}),(0,a.jsx)("button",{onClick:()=>y("pending"),className:"jsx-539ca2085833774d "+(("pending"===h?"on":"")||""),children:"\uD83D\uDCDD İlan Onayı"}),(0,a.jsx)("button",{onClick:()=>y("showcase"),className:"jsx-539ca2085833774d "+(("showcase"===h?"on":"")||""),children:"✨ Vitrin / PRO"}),(0,a.jsx)("button",{onClick:()=>y("users"),className:"jsx-539ca2085833774d "+(("users"===h?"on":"")||""),children:"\uD83D\uDC65 Kullanıcılar"}),(0,a.jsx)("button",{onClick:()=>y("complaints"),className:"jsx-539ca2085833774d "+(("complaints"===h?"on":"")||""),children:"\uD83D\uDEA9 Şikayetler"}),(0,a.jsx)("button",{onClick:()=>y("broadcast"),className:"jsx-539ca2085833774d "+(("broadcast"===h?"on":"")||""),children:"\uD83D\uDCE3 Bildiri G\xf6nder"})]}),(0,a.jsxs)("div",{className:"jsx-539ca2085833774d foot",children:[s?(0,a.jsx)("small",{className:"jsx-539ca2085833774d",children:s.email}):null,(0,a.jsx)("button",{onClick:async()=>{try{await e.auth.signOut()}catch(e){}window.location.href="/login"},className:"jsx-539ca2085833774d logout",children:"\xc7ıkış"})]})]}),(0,a.jsxs)("main",{className:"jsx-539ca2085833774d main",children:[x&&(0,a.jsx)("div",{className:"jsx-539ca2085833774d card",children:(0,a.jsx)("div",{className:"jsx-539ca2085833774d muted",children:"Y\xfckleniyor…"})}),D&&(0,a.jsx)("div",{className:"jsx-539ca2085833774d card err",children:"Bu sayfayı sadece admin g\xf6rebilir."}),!!w&&!x&&!D&&(0,a.jsx)("div",{className:"jsx-539ca2085833774d card err",children:w}),!x&&"admin"===i&&(0,a.jsxs)(a.Fragment,{children:["inbox"===h&&(0,a.jsx)(m,{supa:e,audioRef:_,counts:v,setCounts:N,lastCounts:C}),"pending"===h&&(0,a.jsx)(j,{supa:e,audioRef:_,counts:v,setCounts:N,lastCounts:C}),"showcase"===h&&(0,a.jsx)(p,{supa:e}),"users"===h&&(0,a.jsx)(b,{supa:e}),"complaints"===h&&(0,a.jsx)(f,{supa:e,audioRef:_,counts:v,setCounts:N,lastCounts:C}),"broadcast"===h&&(0,a.jsx)(g,{supa:e})]})]})]}),(0,a.jsx)(n(),{id:"539ca2085833774d",children:".jsx-539ca2085833774d:root{--ink:#0f172a;--muted:#6b7280;--line:#e5e7eb;--card:#ffffff;--bg:#f8fafc;--asbg:#111827;--asfg:#e5e7eb;--accent:#0ea5e9}html.jsx-539ca2085833774d,body.jsx-539ca2085833774d,#__next.jsx-539ca2085833774d{height:100%}body.jsx-539ca2085833774d{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}.admin.jsx-539ca2085833774d{display:grid;grid-template-columns:280px 1fr;min-height:100vh}.side.jsx-539ca2085833774d{background:var(--asbg);color:var(--asfg);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:14px;gap:14px}.brand.jsx-539ca2085833774d{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:10px;font-size:18px}.menu.jsx-539ca2085833774d{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:6px}.menu.jsx-539ca2085833774d button.jsx-539ca2085833774d{all:unset;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:8px;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;padding:10px 12px;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;cursor:pointer;color:#e6eef3;border:1px solid rgba(255,255,255,.06)}.menu.jsx-539ca2085833774d button.on.jsx-539ca2085833774d{background:#0b1220}.menu.jsx-539ca2085833774d button.jsx-539ca2085833774d:hover{background:#0f172a}.foot.jsx-539ca2085833774d{margin-top:auto;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px}.logout.jsx-539ca2085833774d{all:unset;border:1px solid#334155;background:#1f2937;color:#fff;padding:8px 12px;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;cursor:pointer}.main.jsx-539ca2085833774d{padding:16px;display:grid;gap:16px;-webkit-align-content:start;-ms-flex-line-pack:start;align-content:start}.card.jsx-539ca2085833774d{background:var(--card);border:1px solid var(--line);-webkit-border-radius:16px;-moz-border-radius:16px;border-radius:16px;padding:14px;-webkit-box-shadow:0 10px 30px rgba(0,0,0,.06);-moz-box-shadow:0 10px 30px rgba(0,0,0,.06);box-shadow:0 10px 30px rgba(0,0,0,.06)}.muted.jsx-539ca2085833774d{color:var(--muted)}.err.jsx-539ca2085833774d{background:#fff0f0;border-color:#fecaca;color:#991b1b}.row.jsx-539ca2085833774d{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:8px;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.table.jsx-539ca2085833774d{width:100%;border-collapse:collapse}.table.jsx-539ca2085833774d th.jsx-539ca2085833774d,.table.jsx-539ca2085833774d td.jsx-539ca2085833774d{padding:10px;border-bottom:1px solid#eef2f7;text-align:left;font-size:14px}.table.jsx-539ca2085833774d th.jsx-539ca2085833774d{font-weight:800;color:#374151}.bad.jsx-539ca2085833774d{background:#fef2f2;color:#991b1b;border:1px solid#fecaca;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;padding:6px 8px}.good.jsx-539ca2085833774d{background:#ecfdf5;color:#065f46;border:1px solid#a7f3d0;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;padding:6px 8px}.btn.jsx-539ca2085833774d{all:unset;border:1px solid#111827;background:#111827;color:#fff;padding:6px 10px;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;cursor:pointer}.ghost.jsx-539ca2085833774d{all:unset;border:1px solid#d1d5db;background:#fff;color:#111827;padding:6px 10px;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;cursor:pointer}.input.jsx-539ca2085833774d{border:1px solid#e5e7eb;background:#fff;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;padding:8px}.grid2.jsx-539ca2085833774d{display:grid;grid-template-columns:1fr 1fr;gap:14px}@media(max-width:980px){.admin.jsx-539ca2085833774d{grid-template-columns:1fr}.side.jsx-539ca2085833774d{position:-webkit-sticky;position:sticky;top:0;z-index:40}.main.jsx-539ca2085833774d{padding:10px}.grid2.jsx-539ca2085833774d{grid-template-columns:1fr}}"})]})}function m(e){let{supa:s,audioRef:t,counts:i,setCounts:n,lastCounts:l}=e,[d,c]=(0,r.useState)([]),[o,u]=(0,r.useState)(null),[h,m]=(0,r.useState)([]),[j,p]=(0,r.useState)(""),[b,f]=(0,r.useState)(""),g=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let{data:a}=await s.from("conversations").select("id,buyer_auth_id,seller_auth_id,created_at").order("id",{ascending:!1}).limit(50);c(a||[]);let r={...i,inbox:(a||[]).length};n(r),e&&t.current&&r.inbox>(l.current.inbox||0)&&(t.current.currentTime=0,t.current.play().catch(()=>{})),l.current=r}catch(e){}},[s,i,n,t]),y=(0,r.useCallback)(async e=>{u(e);let{data:t}=await s.from("messages").select("id,conv_id,sender_auth_id,receiver_auth_id,body,created_at").eq("conv_id",e).order("created_at",{ascending:!0}).limit(200);m(t||[])},[s]);async function w(){f("");let e=j.trim();if(o&&e)try{let t=h[h.length-1],a=t?t.sender_auth_id:null;if(!a){f("Alıcı belirlenemedi.");return}let{data:{user:i}}=await s.auth.getUser(),n={conv_id:o,sender_auth_id:i.id,receiver_auth_id:a,body:e},{error:r}=await s.from("messages").insert(n);if(r)throw r;p(""),await y(o)}catch(e){f((null==e?void 0:e.message)||"G\xf6nderilemedi")}}async function k(e){f("");try{let{error:t}=await s.rpc("admin_message_delete_hard",{p_msg_id:e});if(t)throw t;m(s=>s.filter(s=>s.id!==e))}catch(e){f((null==e?void 0:e.message)||"Silinemedi")}}return(0,r.useEffect)(()=>{g(!1)},[g]),(0,r.useEffect)(()=>{let e=setInterval(()=>g(!0),1e4);return()=>clearInterval(e)},[g]),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,a.jsx)("h3",{children:"\uD83D\uDCAC Mesajlar"}),(0,a.jsx)("button",{className:"ghost",onClick:()=>g(!0),children:"Yenile"})]}),(0,a.jsxs)("div",{className:"grid2",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("table",{className:"table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"ID"}),(0,a.jsx)("th",{children:"Alıcı/Satıcı"}),(0,a.jsx)("th",{children:"Oluşturulma"}),(0,a.jsx)("th",{})]})}),(0,a.jsxs)("tbody",{children:[(d||[]).map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{children:["#",e.id]}),(0,a.jsxs)("td",{style:{fontSize:12},children:[(0,a.jsxs)("div",{al:"buyer",children:["buyer: ",(0,a.jsx)("code",{children:e.buyer_auth_id})]}),(0,a.jsxs)("div",{al:"seller",children:["seller: ",(0,a.jsx)("code",{children:e.seller_auth_id})]})]}),(0,a.jsx)("td",{children:x(e.created_at)}),(0,a.jsx)("td",{children:(0,a.jsx)("button",{className:"btn",onClick:()=>y(e.id),children:"A\xe7"})})]},e.id)),!(null==d?void 0:d.length)&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:4,className:"muted",children:"Konuşma yok."})})]})]})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,a.jsxs)("h4",{children:["Konuşma #",o||"-"]}),(0,a.jsxs)("span",{className:"muted",children:[h.length," mesaj"]})]}),(0,a.jsxs)("div",{style:{maxHeight:360,overflow:"auto",border:"1px solid #eef2f7",borderRadius:10,padding:10},children:[h.map(e=>(0,a.jsxs)("div",{style:{borderBottom:"1px dashed #eef2f7",padding:"6px 0"},children:[(0,a.jsxs)("div",{style:{fontSize:12,color:"#6b7280"},children:["#",e.id," • ",x(e.created_at)]}),(0,a.jsxs)("div",{style:{fontSize:12,margin:"4px 0"},children:[(0,a.jsx)("b",{children:"from"})," ",(0,a.jsx)("code",{children:e.sender_auth_id})," → ",(0,a.jsx)("b",{children:"to"})," ",(0,a.jsx)("code",{children:e.receiver_auth_id})]}),(0,a.jsx)("div",{children:e.body}),(0,a.jsx)("div",{className:"row",style:{marginTop:6},children:(0,a.jsx)("button",{className:"ghost",onClick:()=>k(e.id),children:"Kalıcı Sil"})})]},e.id)),!h.length&&(0,a.jsx)("div",{className:"muted",children:"Mesaj yok."})]}),(0,a.jsxs)("div",{className:"row",style:{marginTop:10},children:[(0,a.jsx)("input",{className:"input",style:{flex:1},placeholder:"Yanıt yaz…",value:j,onChange:e=>p(e.target.value)}),(0,a.jsx)("button",{className:"btn",onClick:w,children:"G\xf6nder"})]}),b&&(0,a.jsx)("div",{className:"bad",style:{marginTop:8},children:b})]})]})]})}function j(e){let{supa:s,audioRef:t,counts:i,setCounts:n,lastCounts:l}=e,[d,c]=(0,r.useState)([]),o=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{data:a}=await s.from("listings").select("id,title,created_at,city,district,price,currency,status,expires_at,is_showcase").in("status",["pending"]).order("created_at",{ascending:!1}).limit(100);c(a||[]);let r={...i,pending:(a||[]).length};n(r),e&&t.current&&r.pending>(l.current.pending||0)&&(t.current.currentTime=0,t.current.play().catch(()=>{})),l.current=r},[s,i,n,t]);async function x(e){let{error:t}=await s.from("listings").update({status:"active"}).eq("id",e);t||c(s=>s.filter(s=>s.id!==e))}async function u(e){let{error:t}=await s.from("listings").update({status:"rejected"}).eq("id",e);t||c(s=>s.filter(s=>s.id!==e))}return(0,r.useEffect)(()=>{o(!1)},[o]),(0,r.useEffect)(()=>{let e=setInterval(()=>o(!0),1e4);return()=>clearInterval(e)},[o]),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,a.jsx)("h3",{children:"\uD83D\uDCDD Onay Bekleyen İlanlar"}),(0,a.jsx)("button",{className:"ghost",onClick:()=>o(!0),children:"Yenile"})]}),(0,a.jsxs)("table",{className:"table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"ID"}),(0,a.jsx)("th",{children:"Başlık"}),(0,a.jsx)("th",{children:"Konum"}),(0,a.jsx)("th",{children:"Fiyat"}),(0,a.jsx)("th",{children:"Durum"}),(0,a.jsx)("th",{children:"İşlem"})]})}),(0,a.jsxs)("tbody",{children:[(d||[]).map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{children:["#",e.id]}),(0,a.jsx)("td",{children:e.title}),(0,a.jsxs)("td",{children:[e.city," ",e.district?"/ ".concat(e.district):""]}),(0,a.jsx)("td",{children:e.price?"".concat(e.price," ").concat(e.currency||"TRY"):"-"}),(0,a.jsx)("td",{children:(0,a.jsx)("span",{className:"bad",children:"pending"})}),(0,a.jsxs)("td",{className:"row",children:[(0,a.jsx)("button",{className:"btn",onClick:()=>x(e.id),children:"Onayla"}),(0,a.jsx)("button",{className:"ghost",onClick:()=>u(e.id),children:"Reddet"})]})]},e.id)),!(null==d?void 0:d.length)&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"muted",children:"Bekleyen ilan yok."})})]})]})]})}function p(e){let{supa:s}=e,[t,i]=(0,r.useState)([]),[n,l]=(0,r.useState)(""),d=(0,r.useCallback)(async()=>{let{data:e}=await s.from("listings").select("id,title,is_showcase,created_at,price,currency,city,status").eq("status","active").order("created_at",{ascending:!1}).limit(100);i(e||[])},[s]);async function c(e){l("");let{error:t}=await s.from("listings").update({is_showcase:!e.is_showcase}).eq("id",e.id);t?l(t.message):d()}return(0,r.useEffect)(()=>{d()},[d]),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,a.jsx)("h3",{children:"✨ Vitrin / PRO"}),(0,a.jsx)("button",{className:"ghost",onClick:()=>d(),children:"Yenile"})]}),n&&(0,a.jsx)("div",{className:"bad",style:{marginBottom:8},children:n}),(0,a.jsxs)("table",{className:"table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"ID"}),(0,a.jsx)("th",{children:"Başlık"}),(0,a.jsx)("th",{children:"Fiyat"}),(0,a.jsx)("th",{children:"Konum"}),(0,a.jsx)("th",{children:"Vitrin"}),(0,a.jsx)("th",{})]})}),(0,a.jsxs)("tbody",{children:[(t||[]).map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{children:["#",e.id]}),(0,a.jsx)("td",{children:e.title}),(0,a.jsx)("td",{children:e.price?"".concat(e.price," ").concat(e.currency||"TRY"):"-"}),(0,a.jsx)("td",{children:e.city||"-"}),(0,a.jsx)("td",{children:u(e.is_showcase)}),(0,a.jsx)("td",{children:(0,a.jsx)("button",{className:"btn",onClick:()=>c(e),children:e.is_showcase?"Vitrinden \xc7ıkar":"Vitrine Ekle"})})]},e.id)),!(null==t?void 0:t.length)&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"muted",children:"Aktif ilan yok."})})]})]})]})}function b(e){let{supa:s}=e,[t,i]=(0,r.useState)([]),[n,l]=(0,r.useState)(12),[d,c]=(0,r.useState)(""),o=(0,r.useCallback)(async()=>{let{data:e}=await s.from("users").select("auth_user_id, email, full_name, role, premium_until, created_at").order("created_at",{ascending:!1}).limit(200);i(e||[])},[s]);async function u(e,t){c("");let{error:a}=await s.from("users").update({role:t}).eq("auth_user_id",e);a?c(a.message):o()}async function h(e){c("");let t=Number(n)||12;if((await s.rpc("admin_grant_pro",{p_user_id:e,p_months:t})).error){let{data:a}=await s.from("users").select("premium_until").eq("auth_user_id",e).single(),i=new Date,n=(null==a?void 0:a.premium_until)?new Date(a.premium_until):i,r=new Date(n>i?n:i);r.setMonth(r.getMonth()+t);let l=r.toISOString(),{error:d}=await s.from("users").update({premium_until:l}).eq("auth_user_id",e);if(d){c(d.message);return}}o()}return(0,r.useEffect)(()=>{o()},[o]),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,a.jsx)("h3",{children:"\uD83D\uDC65 Kullanıcılar"}),(0,a.jsx)("button",{className:"ghost",onClick:()=>o(),children:"Yenile"})]}),d&&(0,a.jsx)("div",{className:"bad",style:{marginBottom:8},children:d}),(0,a.jsxs)("div",{className:"row",style:{marginBottom:8},children:[(0,a.jsx)("label",{children:"PRO ay (varsayılan 12):"}),(0,a.jsx)("input",{className:"input",style:{width:90},type:"number",min:"1",max:"36",value:n,onChange:e=>l(e.target.value)})]}),(0,a.jsxs)("table",{className:"table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"E-posta"}),(0,a.jsx)("th",{children:"Ad"}),(0,a.jsx)("th",{children:"Rol"}),(0,a.jsx)("th",{children:"PRO Bitiş"}),(0,a.jsx)("th",{children:"Kayıt"}),(0,a.jsx)("th",{children:"İşlem"})]})}),(0,a.jsxs)("tbody",{children:[(t||[]).map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.email||"-"}),(0,a.jsx)("td",{children:e.full_name||"-"}),(0,a.jsx)("td",{children:(0,a.jsx)("b",{children:e.role||"user"})}),(0,a.jsx)("td",{children:e.premium_until?x(e.premium_until):"—"}),(0,a.jsx)("td",{children:x(e.created_at)}),(0,a.jsxs)("td",{className:"row",children:[(0,a.jsx)("button",{className:"ghost",onClick:()=>u(e.auth_user_id,"user"),children:"user"}),(0,a.jsx)("button",{className:"ghost",onClick:()=>u(e.auth_user_id,"moderator"),children:"moderator"}),(0,a.jsx)("button",{className:"ghost",onClick:()=>u(e.auth_user_id,"admin"),children:"admin"}),(0,a.jsxs)("button",{className:"btn",onClick:()=>h(e.auth_user_id),children:["PRO Ver (+",n," ay)"]})]})]},e.auth_user_id)),!(null==t?void 0:t.length)&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"muted",children:"Kayıt yok."})})]})]})]})}function f(e){let{supa:s,audioRef:t,counts:i,setCounts:n,lastCounts:l}=e,[d,c]=(0,r.useState)([]),[o,x]=(0,r.useState)(""),u=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let{data:a,error:r}=await s.from("reports").select("id, created_at, type, ref_id, reporter_auth_id, note, status");if(r){c([]);return}c(a||[]);let d={...i,complaints:(a||[]).length};n(d),e&&t.current&&d.complaints>(l.current.complaints||0)&&(t.current.currentTime=0,t.current.play().catch(()=>{})),l.current=d}catch(e){c([])}},[s,i,n,t]);async function h(e,t){x("");let{error:a}=await s.from("reports").update({status:t}).eq("id",e);a?x(a.message):u(!1)}return(0,r.useEffect)(()=>{u(!1)},[u]),(0,r.useEffect)(()=>{let e=setInterval(()=>u(!0),15e3);return()=>clearInterval(e)},[u]),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,a.jsx)("h3",{children:"\uD83D\uDEA9 Şikayetler"}),(0,a.jsx)("button",{className:"ghost",onClick:()=>u(!0),children:"Yenile"})]}),o&&(0,a.jsx)("div",{className:"bad",style:{marginBottom:8},children:o}),(0,a.jsxs)("table",{className:"table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"ID"}),(0,a.jsx)("th",{children:"T\xfcr"}),(0,a.jsx)("th",{children:"Referans"}),(0,a.jsx)("th",{children:"Rapor Eden"}),(0,a.jsx)("th",{children:"Not"}),(0,a.jsx)("th",{children:"Durum"}),(0,a.jsx)("th",{})]})}),(0,a.jsxs)("tbody",{children:[(d||[]).map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{children:["#",e.id]}),(0,a.jsx)("td",{children:e.type||"-"}),(0,a.jsx)("td",{children:e.ref_id||"-"}),(0,a.jsx)("td",{children:(0,a.jsx)("code",{children:e.reporter_auth_id})}),(0,a.jsx)("td",{children:e.note||"-"}),(0,a.jsx)("td",{children:e.status||"open"}),(0,a.jsxs)("td",{className:"row",children:[(0,a.jsx)("button",{className:"ghost",onClick:()=>h(e.id,"in_review"),children:"İncele"}),(0,a.jsx)("button",{className:"btn",onClick:()=>h(e.id,"closed"),children:"Kapattım"})]})]},e.id)),!(null==d?void 0:d.length)&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,className:"muted",children:"Şikayet yok (veya tablo yok)."})})]})]})]})}function g(e){let{supa:s}=e,[t,i]=(0,r.useState)(""),[n,l]=(0,r.useState)(""),[d,c]=(0,r.useState)("");async function o(){if(c(""),!t.trim()||!n.trim()){c("Başlık ve mesaj zorunlu.");return}let{error:e}=await s.from("broadcasts").insert({title:t,body:n});if(e){c("Broadcast tablosu yoksa: admin kullanıcılarına e-posta veya push entegre edin.");return}i(""),l(""),c("G\xf6nderildi.")}return(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h3",{children:"\uD83D\uDCE3 Bildiri G\xf6nder"}),(0,a.jsx)("div",{className:"row",style:{marginTop:8},children:(0,a.jsx)("input",{className:"input",style:{flex:1},placeholder:"Başlık",value:t,onChange:e=>i(e.target.value)})}),(0,a.jsx)("div",{className:"row",style:{marginTop:8},children:(0,a.jsx)("textarea",{className:"input",rows:5,style:{width:"100%"},placeholder:"Mesaj i\xe7eriği",value:n,onChange:e=>l(e.target.value)})}),(0,a.jsxs)("div",{className:"row",style:{marginTop:8},children:[(0,a.jsx)("button",{className:"btn",onClick:o,children:"G\xf6nder"}),d&&(0,a.jsx)("div",{className:"muted",children:d})]})]})}},9008:function(e,s,t){e.exports=t(3867)}},function(e){e.O(0,[645,941,888,774,179],function(){return e(e.s=7953)}),_N_E=e.O()}]);