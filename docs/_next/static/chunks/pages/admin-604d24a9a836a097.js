(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{7953:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return t(1430)}])},1430:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return u}});var s=t(5893),c=t(645),n=t.n(c),i=t(7294),r=t(9008),l=t.n(r),d=t(4941);let o=null,x=e=>e?new Date(e).toLocaleString():"",b=e=>e?"Evet":"Hayır";function u(){let e=function(){if(o)return o;let e="https://krmjbjfwmnhzfhnrswgg.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtybWpiamZ3bW5oemZobnJzd2dnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3NjQ2NjYsImV4cCI6MjA3NTM0MDY2Nn0.cuM0AjBKOND7Q95Zjyp8jX9QoLI51OFfq4uJRkQmfM4";return e&&a?o=(0,d.eI)(e,a):null}(),[a,t]=(0,i.useState)(null),[c,r]=(0,i.useState)(null),[x,b]=(0,i.useState)(!0),[u,v]=(0,i.useState)("inbox"),[y,w]=(0,i.useState)(""),k=(0,i.useRef)(null),[_,N]=(0,i.useState)({pending:0,inbox:0,complaints:0}),C=(0,i.useRef)(_);(0,i.useEffect)(()=>{let a=!0;return(async()=>{try{if(!e){w("Supabase yapılandırması eksik."),b(!1);return}let{data:{user:s}}=await e.auth.getUser();if(!a)return;if(!s){w("\xd6nce giriş yapın."),b(!1);return}t(s);let{data:c,error:n}=await e.from("users").select("role").eq("auth_user_id",s.id).single();if(n){w("Kullanıcı rol\xfc okunamadı."),b(!1);return}r((null==c?void 0:c.role)||null)}catch(e){w((null==e?void 0:e.message)||"Hata")}finally{a&&b(!1)}})(),()=>{a=!1}},[e]);let D=!x&&"admin"!==c;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(l(),{children:[(0,s.jsx)("title",{className:"jsx-2ca5be47819bc668",children:"Admin – \xdcreten Eller"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1",className:"jsx-2ca5be47819bc668"})]}),(0,s.jsx)("audio",{ref:k,src:"/notify.wav",preload:"auto",className:"jsx-2ca5be47819bc668"}),(0,s.jsxs)("div",{className:"jsx-2ca5be47819bc668 admin",children:[(0,s.jsxs)("aside",{className:"jsx-2ca5be47819bc668 side",children:[(0,s.jsxs)("div",{className:"jsx-2ca5be47819bc668 brand",children:[(0,s.jsx)("img",{src:"/logo.png",width:"28",height:"28",alt:"logo",className:"jsx-2ca5be47819bc668"}),(0,s.jsx)("b",{className:"jsx-2ca5be47819bc668",children:"Y\xf6netim"})]}),(0,s.jsxs)("nav",{className:"jsx-2ca5be47819bc668 menu",children:[(0,s.jsx)("button",{onClick:()=>v("inbox"),className:"jsx-2ca5be47819bc668 "+(("inbox"===u?"on":"")||""),children:"\uD83D\uDCAC Mesajlar"}),(0,s.jsx)("button",{onClick:()=>v("pending"),className:"jsx-2ca5be47819bc668 "+(("pending"===u?"on":"")||""),children:"\uD83D\uDCDD İlan Onayı"}),(0,s.jsx)("button",{onClick:()=>v("showcase"),className:"jsx-2ca5be47819bc668 "+(("showcase"===u?"on":"")||""),children:"✨ Vitrin / PRO"}),(0,s.jsx)("button",{onClick:()=>v("users"),className:"jsx-2ca5be47819bc668 "+(("users"===u?"on":"")||""),children:"\uD83D\uDC65 Kullanıcılar"}),(0,s.jsx)("button",{onClick:()=>v("complaints"),className:"jsx-2ca5be47819bc668 "+(("complaints"===u?"on":"")||""),children:"\uD83D\uDEA9 Şikayetler"}),(0,s.jsx)("button",{onClick:()=>v("broadcast"),className:"jsx-2ca5be47819bc668 "+(("broadcast"===u?"on":"")||""),children:"\uD83D\uDCE3 Bildiri G\xf6nder"})]}),(0,s.jsxs)("div",{className:"jsx-2ca5be47819bc668 foot",children:[a?(0,s.jsx)("small",{className:"jsx-2ca5be47819bc668",children:a.email}):null,(0,s.jsx)("button",{onClick:async()=>{try{await e.auth.signOut()}catch(e){}window.location.href="/login"},className:"jsx-2ca5be47819bc668 logout",children:"\xc7ıkış"})]})]}),(0,s.jsxs)("main",{className:"jsx-2ca5be47819bc668 main",children:[x&&(0,s.jsx)("div",{className:"jsx-2ca5be47819bc668 card",children:(0,s.jsx)("div",{className:"jsx-2ca5be47819bc668 muted",children:"Y\xfckleniyor…"})}),D&&(0,s.jsx)("div",{className:"jsx-2ca5be47819bc668 card err",children:"Bu sayfayı sadece admin g\xf6rebilir."}),!!y&&!x&&!D&&(0,s.jsx)("div",{className:"jsx-2ca5be47819bc668 card err",children:y}),!x&&"admin"===c&&(0,s.jsxs)(s.Fragment,{children:["inbox"===u&&(0,s.jsx)(h,{supa:e,audioRef:k,counts:_,setCounts:N,lastCounts:C}),"pending"===u&&(0,s.jsx)(p,{supa:e,audioRef:k,counts:_,setCounts:N,lastCounts:C}),"showcase"===u&&(0,s.jsx)(m,{supa:e}),"users"===u&&(0,s.jsx)(j,{supa:e}),"complaints"===u&&(0,s.jsx)(f,{supa:e,audioRef:k,counts:_,setCounts:N,lastCounts:C}),"broadcast"===u&&(0,s.jsx)(g,{supa:e})]})]})]}),(0,s.jsx)(n(),{id:"2ca5be47819bc668",children:'.jsx-2ca5be47819bc668:root{--bg:#0b0b0b;--ink:#f8fafc;--muted:#cbd5e1;--line:#222;--accent:#d4a373;--accent-soft:rgba(212,163,115,.35)}html.jsx-2ca5be47819bc668,body.jsx-2ca5be47819bc668,#__next.jsx-2ca5be47819bc668{height:100%}body.jsx-2ca5be47819bc668{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}.topbar.jsx-2ca5be47819bc668{position:-webkit-sticky;position:sticky;top:0;z-index:50;display:grid;grid-template-columns:1fr auto;gap:12px;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;padding:12px 16px;background:rgba(12,12,12,.9);-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}.brand.jsx-2ca5be47819bc668{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:10px;font-weight:900}.brand.jsx-2ca5be47819bc668 span.jsx-2ca5be47819bc668{color:var(--ink)}.actions.jsx-2ca5be47819bc668{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:8px;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.btn.jsx-2ca5be47819bc668{border:1.5px solid var(--accent);background:transparent;color:var(--ink);padding:8px 12px;-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;font-weight:800;cursor:pointer;-webkit-box-shadow:0 0 0 1px var(--accent)inset,0 0 12px var(--accent-soft);-moz-box-shadow:0 0 0 1px var(--accent)inset,0 0 12px var(--accent-soft);box-shadow:0 0 0 1px var(--accent)inset,0 0 12px var(--accent-soft);-webkit-transition:.2s ease;-moz-transition:.2s ease;-o-transition:.2s ease;transition:.2s ease}.btn.jsx-2ca5be47819bc668:hover{-webkit-transform:translatey(-1px);-moz-transform:translatey(-1px);-ms-transform:translatey(-1px);-o-transform:translatey(-1px);transform:translatey(-1px);-webkit-box-shadow:0 0 0 1px var(--accent)inset,0 0 16px var(--accent-soft);-moz-box-shadow:0 0 0 1px var(--accent)inset,0 0 16px var(--accent-soft);box-shadow:0 0 0 1px var(--accent)inset,0 0 16px var(--accent-soft)}.btn.primary.jsx-2ca5be47819bc668{background:var(--accent);color:#0b0b0b}.wrap.jsx-2ca5be47819bc668{max-width:1200px;margin:16px auto;padding:0 16px}.grid.jsx-2ca5be47819bc668{display:grid;gap:16px;grid-template-columns:260px 1fr}@media(max-width:980px){.grid.jsx-2ca5be47819bc668{grid-template-columns:1fr}}.nav.jsx-2ca5be47819bc668{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:10px;position:-webkit-sticky;position:sticky;top:68px}.nav.jsx-2ca5be47819bc668 .item.jsx-2ca5be47819bc668{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:10px;padding:10px 12px;cursor:pointer;text-decoration:none;color:var(--ink);-webkit-border-radius:14px;-moz-border-radius:14px;border-radius:14px;border:2px solid var(--accent);-webkit-box-shadow:0 0 0 1px var(--accent)inset,0 0 10px var(--accent-soft);-moz-box-shadow:0 0 0 1px var(--accent)inset,0 0 10px var(--accent-soft);box-shadow:0 0 0 1px var(--accent)inset,0 0 10px var(--accent-soft);background:-webkit-linear-gradient(top,rgba(212,163,115,.08),rgba(212,163,115,.02));background:-moz-linear-gradient(top,rgba(212,163,115,.08),rgba(212,163,115,.02));background:-o-linear-gradient(top,rgba(212,163,115,.08),rgba(212,163,115,.02));background:linear-gradient(180deg,rgba(212,163,115,.08),rgba(212,163,115,.02));-webkit-transition:.2s;-moz-transition:.2s;-o-transition:.2s;transition:.2s}.nav.jsx-2ca5be47819bc668 .item.jsx-2ca5be47819bc668:hover{-webkit-transform:translatex(2px);-moz-transform:translatex(2px);-ms-transform:translatex(2px);-o-transform:translatex(2px);transform:translatex(2px);-webkit-box-shadow:0 0 0 1px var(--accent)inset,0 0 16px var(--accent-soft);-moz-box-shadow:0 0 0 1px var(--accent)inset,0 0 16px var(--accent-soft);box-shadow:0 0 0 1px var(--accent)inset,0 0 16px var(--accent-soft)}.nav.jsx-2ca5be47819bc668 .item.active.jsx-2ca5be47819bc668{background:var(--accent);color:#0b0b0b;font-weight:900}.card.jsx-2ca5be47819bc668{-webkit-border-radius:18px;-moz-border-radius:18px;border-radius:18px;padding:16px;border:2px solid var(--accent);-webkit-box-shadow:0 0 0 1px var(--accent)inset,0 0 18px var(--accent-soft);-moz-box-shadow:0 0 0 1px var(--accent)inset,0 0 18px var(--accent-soft);box-shadow:0 0 0 1px var(--accent)inset,0 0 18px var(--accent-soft);background:rgba(20,20,20,.92)}.card.jsx-2ca5be47819bc668 h2.jsx-2ca5be47819bc668{margin:0 0 10px;color:var(--ink)}.field.jsx-2ca5be47819bc668{display:grid;gap:6px}.field.jsx-2ca5be47819bc668 label.jsx-2ca5be47819bc668{color:var(--muted);font-weight:700}input[type="text"].jsx-2ca5be47819bc668,input[type="number"].jsx-2ca5be47819bc668,input[type="email"].jsx-2ca5be47819bc668,input[type="password"].jsx-2ca5be47819bc668,textarea.jsx-2ca5be47819bc668,select.jsx-2ca5be47819bc668{width:100%;color:var(--ink);background:#0f0f0f;border:2px solid var(--accent);-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;padding:10px 12px;outline:none;-webkit-box-shadow:0 0 0 1px var(--accent)inset,0 0 10px var(--accent-soft);-moz-box-shadow:0 0 0 1px var(--accent)inset,0 0 10px var(--accent-soft);box-shadow:0 0 0 1px var(--accent)inset,0 0 10px var(--accent-soft)}input.jsx-2ca5be47819bc668::-webkit-input-placeholder,textarea.jsx-2ca5be47819bc668::-webkit-input-placeholder{color:#9aa4b2}input.jsx-2ca5be47819bc668:-moz-placeholder,textarea.jsx-2ca5be47819bc668:-moz-placeholder{color:#9aa4b2}input.jsx-2ca5be47819bc668::-moz-placeholder,textarea.jsx-2ca5be47819bc668::-moz-placeholder{color:#9aa4b2}input.jsx-2ca5be47819bc668:-ms-input-placeholder,textarea.jsx-2ca5be47819bc668:-ms-input-placeholder{color:#9aa4b2}input.jsx-2ca5be47819bc668::-ms-input-placeholder,textarea.jsx-2ca5be47819bc668::-ms-input-placeholder{color:#9aa4b2}input.jsx-2ca5be47819bc668::placeholder,textarea.jsx-2ca5be47819bc668::placeholder{color:#9aa4b2}select.jsx-2ca5be47819bc668 option.jsx-2ca5be47819bc668{color:#0b0b0b;background:#fff}table.jsx-2ca5be47819bc668{width:100%;border-collapse:separate;border-spacing:0}thead.jsx-2ca5be47819bc668 th.jsx-2ca5be47819bc668{text-align:left;font-weight:900;padding:10px 12px;background:#131313;color:var(--ink);border-bottom:2px solid var(--accent)}tbody.jsx-2ca5be47819bc668 td.jsx-2ca5be47819bc668{padding:10px 12px;color:var(--ink);border-bottom:1px solid#1a1a1a}tbody.jsx-2ca5be47819bc668 tr.jsx-2ca5be47819bc668{background:rgba(255,255,255,.02);border-left:2px solid var(--accent);border-right:2px solid var(--accent)}tbody.jsx-2ca5be47819bc668 tr.jsx-2ca5be47819bc668:first-child{border-top:2px solid var(--accent)}tbody.jsx-2ca5be47819bc668 tr.jsx-2ca5be47819bc668:last-child{border-bottom:2px solid var(--accent)}tbody.jsx-2ca5be47819bc668 tr.jsx-2ca5be47819bc668:hover{background:rgba(212,163,115,.08);-webkit-box-shadow:inset 0 0 12px var(--accent-soft);-moz-box-shadow:inset 0 0 12px var(--accent-soft);box-shadow:inset 0 0 12px var(--accent-soft)}.toast.jsx-2ca5be47819bc668{position:fixed;right:16px;bottom:16px;z-index:60;background:#121212;color:var(--ink);padding:10px 14px;-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;border:2px solid var(--accent);-webkit-box-shadow:0 0 0 1px var(--accent)inset,0 0 14px var(--accent-soft);-moz-box-shadow:0 0 0 1px var(--accent)inset,0 0 14px var(--accent-soft);box-shadow:0 0 0 1px var(--accent)inset,0 0 14px var(--accent-soft)}.title.jsx-2ca5be47819bc668{font-size:24px;font-weight:900;margin:10px 0 16px}.legal.jsx-2ca5be47819bc668{margin-top:18px;border-top:1px solid var(--line);color:var(--muted)}'})]})}function h(e){let{supa:a,audioRef:t,counts:c,setCounts:n,lastCounts:r}=e,[l,d]=(0,i.useState)([]),[o,b]=(0,i.useState)(null),[u,h]=(0,i.useState)([]),[p,m]=(0,i.useState)(""),[j,f]=(0,i.useState)(""),g=(0,i.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let{data:s}=await a.from("conversations").select("id,buyer_auth_id,seller_auth_id,created_at").order("id",{ascending:!1}).limit(50);d(s||[]);let i={...c,inbox:(s||[]).length};n(i),e&&t.current&&i.inbox>(r.current.inbox||0)&&(t.current.currentTime=0,t.current.play().catch(()=>{})),r.current=i}catch(e){}},[a,c,n,t]),v=(0,i.useCallback)(async e=>{b(e);let{data:t}=await a.from("messages").select("id,conv_id,sender_auth_id,receiver_auth_id,body,created_at").eq("conv_id",e).order("created_at",{ascending:!0}).limit(200);h(t||[])},[a]);async function y(){f("");let e=p.trim();if(o&&e)try{let t=u[u.length-1],s=t?t.sender_auth_id:null;if(!s){f("Alıcı belirlenemedi.");return}let{data:{user:c}}=await a.auth.getUser(),n={conv_id:o,sender_auth_id:c.id,receiver_auth_id:s,body:e},{error:i}=await a.from("messages").insert(n);if(i)throw i;m(""),await v(o)}catch(e){f((null==e?void 0:e.message)||"G\xf6nderilemedi")}}async function w(e){f("");try{let{error:t}=await a.rpc("admin_message_delete_hard",{p_msg_id:e});if(t)throw t;h(a=>a.filter(a=>a.id!==e))}catch(e){f((null==e?void 0:e.message)||"Silinemedi")}}return(0,i.useEffect)(()=>{g(!1)},[g]),(0,i.useEffect)(()=>{let e=setInterval(()=>g(!0),1e4);return()=>clearInterval(e)},[g]),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,s.jsx)("h3",{children:"\uD83D\uDCAC Mesajlar"}),(0,s.jsx)("button",{className:"ghost",onClick:()=>g(!0),children:"Yenile"})]}),(0,s.jsxs)("div",{className:"grid2",children:[(0,s.jsx)("div",{children:(0,s.jsxs)("table",{className:"table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"ID"}),(0,s.jsx)("th",{children:"Alıcı/Satıcı"}),(0,s.jsx)("th",{children:"Oluşturulma"}),(0,s.jsx)("th",{})]})}),(0,s.jsxs)("tbody",{children:[(l||[]).map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{children:["#",e.id]}),(0,s.jsxs)("td",{style:{fontSize:12},children:[(0,s.jsxs)("div",{al:"buyer",children:["buyer: ",(0,s.jsx)("code",{children:e.buyer_auth_id})]}),(0,s.jsxs)("div",{al:"seller",children:["seller: ",(0,s.jsx)("code",{children:e.seller_auth_id})]})]}),(0,s.jsx)("td",{children:x(e.created_at)}),(0,s.jsx)("td",{children:(0,s.jsx)("button",{className:"btn",onClick:()=>v(e.id),children:"A\xe7"})})]},e.id)),!(null==l?void 0:l.length)&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:4,className:"muted",children:"Konuşma yok."})})]})]})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,s.jsxs)("h4",{children:["Konuşma #",o||"-"]}),(0,s.jsxs)("span",{className:"muted",children:[u.length," mesaj"]})]}),(0,s.jsxs)("div",{style:{maxHeight:360,overflow:"auto",border:"1px solid #eef2f7",borderRadius:10,padding:10},children:[u.map(e=>(0,s.jsxs)("div",{style:{borderBottom:"1px dashed #eef2f7",padding:"6px 0"},children:[(0,s.jsxs)("div",{style:{fontSize:12,color:"#6b7280"},children:["#",e.id," • ",x(e.created_at)]}),(0,s.jsxs)("div",{style:{fontSize:12,margin:"4px 0"},children:[(0,s.jsx)("b",{children:"from"})," ",(0,s.jsx)("code",{children:e.sender_auth_id})," → ",(0,s.jsx)("b",{children:"to"})," ",(0,s.jsx)("code",{children:e.receiver_auth_id})]}),(0,s.jsx)("div",{children:e.body}),(0,s.jsx)("div",{className:"row",style:{marginTop:6},children:(0,s.jsx)("button",{className:"ghost",onClick:()=>w(e.id),children:"Kalıcı Sil"})})]},e.id)),!u.length&&(0,s.jsx)("div",{className:"muted",children:"Mesaj yok."})]}),(0,s.jsxs)("div",{className:"row",style:{marginTop:10},children:[(0,s.jsx)("input",{className:"input",style:{flex:1},placeholder:"Yanıt yaz…",value:p,onChange:e=>m(e.target.value)}),(0,s.jsx)("button",{className:"btn",onClick:y,children:"G\xf6nder"})]}),j&&(0,s.jsx)("div",{className:"bad",style:{marginTop:8},children:j})]})]})]})}function p(e){let{supa:a,audioRef:t,counts:c,setCounts:n,lastCounts:r}=e,[l,d]=(0,i.useState)([]),o=(0,i.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{data:s}=await a.from("listings").select("id,title,created_at,city,district,price,currency,status,expires_at,is_showcase").in("status",["pending"]).order("created_at",{ascending:!1}).limit(100);d(s||[]);let i={...c,pending:(s||[]).length};n(i),e&&t.current&&i.pending>(r.current.pending||0)&&(t.current.currentTime=0,t.current.play().catch(()=>{})),r.current=i},[a,c,n,t]);async function x(e){let{error:t}=await a.from("listings").update({status:"active"}).eq("id",e);t||d(a=>a.filter(a=>a.id!==e))}async function b(e){let{error:t}=await a.from("listings").update({status:"rejected"}).eq("id",e);t||d(a=>a.filter(a=>a.id!==e))}return(0,i.useEffect)(()=>{o(!1)},[o]),(0,i.useEffect)(()=>{let e=setInterval(()=>o(!0),1e4);return()=>clearInterval(e)},[o]),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,s.jsx)("h3",{children:"\uD83D\uDCDD Onay Bekleyen İlanlar"}),(0,s.jsx)("button",{className:"ghost",onClick:()=>o(!0),children:"Yenile"})]}),(0,s.jsxs)("table",{className:"table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"ID"}),(0,s.jsx)("th",{children:"Başlık"}),(0,s.jsx)("th",{children:"Konum"}),(0,s.jsx)("th",{children:"Fiyat"}),(0,s.jsx)("th",{children:"Durum"}),(0,s.jsx)("th",{children:"İşlem"})]})}),(0,s.jsxs)("tbody",{children:[(l||[]).map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{children:["#",e.id]}),(0,s.jsx)("td",{children:e.title}),(0,s.jsxs)("td",{children:[e.city," ",e.district?"/ ".concat(e.district):""]}),(0,s.jsx)("td",{children:e.price?"".concat(e.price," ").concat(e.currency||"TRY"):"-"}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{className:"bad",children:"pending"})}),(0,s.jsxs)("td",{className:"row",children:[(0,s.jsx)("button",{className:"btn",onClick:()=>x(e.id),children:"Onayla"}),(0,s.jsx)("button",{className:"ghost",onClick:()=>b(e.id),children:"Reddet"})]})]},e.id)),!(null==l?void 0:l.length)&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:6,className:"muted",children:"Bekleyen ilan yok."})})]})]})]})}function m(e){let{supa:a}=e,[t,c]=(0,i.useState)([]),[n,r]=(0,i.useState)(""),l=(0,i.useCallback)(async()=>{let{data:e}=await a.from("listings").select("id,title,is_showcase,created_at,price,currency,city,status").eq("status","active").order("created_at",{ascending:!1}).limit(100);c(e||[])},[a]);async function d(e){r("");let{error:t}=await a.from("listings").update({is_showcase:!e.is_showcase}).eq("id",e.id);t?r(t.message):l()}return(0,i.useEffect)(()=>{l()},[l]),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,s.jsx)("h3",{children:"✨ Vitrin / PRO"}),(0,s.jsx)("button",{className:"ghost",onClick:()=>l(),children:"Yenile"})]}),n&&(0,s.jsx)("div",{className:"bad",style:{marginBottom:8},children:n}),(0,s.jsxs)("table",{className:"table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"ID"}),(0,s.jsx)("th",{children:"Başlık"}),(0,s.jsx)("th",{children:"Fiyat"}),(0,s.jsx)("th",{children:"Konum"}),(0,s.jsx)("th",{children:"Vitrin"}),(0,s.jsx)("th",{})]})}),(0,s.jsxs)("tbody",{children:[(t||[]).map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{children:["#",e.id]}),(0,s.jsx)("td",{children:e.title}),(0,s.jsx)("td",{children:e.price?"".concat(e.price," ").concat(e.currency||"TRY"):"-"}),(0,s.jsx)("td",{children:e.city||"-"}),(0,s.jsx)("td",{children:b(e.is_showcase)}),(0,s.jsx)("td",{children:(0,s.jsx)("button",{className:"btn",onClick:()=>d(e),children:e.is_showcase?"Vitrinden \xc7ıkar":"Vitrine Ekle"})})]},e.id)),!(null==t?void 0:t.length)&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:6,className:"muted",children:"Aktif ilan yok."})})]})]})]})}function j(e){let{supa:a}=e,[t,c]=(0,i.useState)([]),[n,r]=(0,i.useState)(12),[l,d]=(0,i.useState)(""),o=(0,i.useCallback)(async()=>{let{data:e}=await a.from("users").select("auth_user_id, email, full_name, role, premium_until, created_at").order("created_at",{ascending:!1}).limit(200);c(e||[])},[a]);async function b(e,t){d("");let{error:s}=await a.from("users").update({role:t}).eq("auth_user_id",e);s?d(s.message):o()}async function u(e){d("");let t=Number(n)||12;if((await a.rpc("admin_grant_pro",{p_user_id:e,p_months:t})).error){let{data:s}=await a.from("users").select("premium_until").eq("auth_user_id",e).single(),c=new Date,n=(null==s?void 0:s.premium_until)?new Date(s.premium_until):c,i=new Date(n>c?n:c);i.setMonth(i.getMonth()+t);let r=i.toISOString(),{error:l}=await a.from("users").update({premium_until:r}).eq("auth_user_id",e);if(l){d(l.message);return}}o()}return(0,i.useEffect)(()=>{o()},[o]),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,s.jsx)("h3",{children:"\uD83D\uDC65 Kullanıcılar"}),(0,s.jsx)("button",{className:"ghost",onClick:()=>o(),children:"Yenile"})]}),l&&(0,s.jsx)("div",{className:"bad",style:{marginBottom:8},children:l}),(0,s.jsxs)("div",{className:"row",style:{marginBottom:8},children:[(0,s.jsx)("label",{children:"PRO ay (varsayılan 12):"}),(0,s.jsx)("input",{className:"input",style:{width:90},type:"number",min:"1",max:"36",value:n,onChange:e=>r(e.target.value)})]}),(0,s.jsxs)("table",{className:"table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"E-posta"}),(0,s.jsx)("th",{children:"Ad"}),(0,s.jsx)("th",{children:"Rol"}),(0,s.jsx)("th",{children:"PRO Bitiş"}),(0,s.jsx)("th",{children:"Kayıt"}),(0,s.jsx)("th",{children:"İşlem"})]})}),(0,s.jsxs)("tbody",{children:[(t||[]).map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:e.email||"-"}),(0,s.jsx)("td",{children:e.full_name||"-"}),(0,s.jsx)("td",{children:(0,s.jsx)("b",{children:e.role||"user"})}),(0,s.jsx)("td",{children:e.premium_until?x(e.premium_until):"—"}),(0,s.jsx)("td",{children:x(e.created_at)}),(0,s.jsxs)("td",{className:"row",children:[(0,s.jsx)("button",{className:"ghost",onClick:()=>b(e.auth_user_id,"user"),children:"user"}),(0,s.jsx)("button",{className:"ghost",onClick:()=>b(e.auth_user_id,"moderator"),children:"moderator"}),(0,s.jsx)("button",{className:"ghost",onClick:()=>b(e.auth_user_id,"admin"),children:"admin"}),(0,s.jsxs)("button",{className:"btn",onClick:()=>u(e.auth_user_id),children:["PRO Ver (+",n," ay)"]})]})]},e.auth_user_id)),!(null==t?void 0:t.length)&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:6,className:"muted",children:"Kayıt yok."})})]})]})]})}function f(e){let{supa:a,audioRef:t,counts:c,setCounts:n,lastCounts:r}=e,[l,d]=(0,i.useState)([]),[o,x]=(0,i.useState)(""),b=(0,i.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let{data:s,error:i}=await a.from("reports").select("id, created_at, type, ref_id, reporter_auth_id, note, status");if(i){d([]);return}d(s||[]);let l={...c,complaints:(s||[]).length};n(l),e&&t.current&&l.complaints>(r.current.complaints||0)&&(t.current.currentTime=0,t.current.play().catch(()=>{})),r.current=l}catch(e){d([])}},[a,c,n,t]);async function u(e,t){x("");let{error:s}=await a.from("reports").update({status:t}).eq("id",e);s?x(s.message):b(!1)}return(0,i.useEffect)(()=>{b(!1)},[b]),(0,i.useEffect)(()=>{let e=setInterval(()=>b(!0),15e3);return()=>clearInterval(e)},[b]),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,s.jsx)("h3",{children:"\uD83D\uDEA9 Şikayetler"}),(0,s.jsx)("button",{className:"ghost",onClick:()=>b(!0),children:"Yenile"})]}),o&&(0,s.jsx)("div",{className:"bad",style:{marginBottom:8},children:o}),(0,s.jsxs)("table",{className:"table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"ID"}),(0,s.jsx)("th",{children:"T\xfcr"}),(0,s.jsx)("th",{children:"Referans"}),(0,s.jsx)("th",{children:"Rapor Eden"}),(0,s.jsx)("th",{children:"Not"}),(0,s.jsx)("th",{children:"Durum"}),(0,s.jsx)("th",{})]})}),(0,s.jsxs)("tbody",{children:[(l||[]).map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{children:["#",e.id]}),(0,s.jsx)("td",{children:e.type||"-"}),(0,s.jsx)("td",{children:e.ref_id||"-"}),(0,s.jsx)("td",{children:(0,s.jsx)("code",{children:e.reporter_auth_id})}),(0,s.jsx)("td",{children:e.note||"-"}),(0,s.jsx)("td",{children:e.status||"open"}),(0,s.jsxs)("td",{className:"row",children:[(0,s.jsx)("button",{className:"ghost",onClick:()=>u(e.id,"in_review"),children:"İncele"}),(0,s.jsx)("button",{className:"btn",onClick:()=>u(e.id,"closed"),children:"Kapattım"})]})]},e.id)),!(null==l?void 0:l.length)&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,className:"muted",children:"Şikayet yok (veya tablo yok)."})})]})]})]})}function g(e){let{supa:a}=e,[t,c]=(0,i.useState)(""),[n,r]=(0,i.useState)(""),[l,d]=(0,i.useState)("");async function o(){if(d(""),!t.trim()||!n.trim()){d("Başlık ve mesaj zorunlu.");return}let{error:e}=await a.from("broadcasts").insert({title:t,body:n});if(e){d("Broadcast tablosu yoksa: admin kullanıcılarına e-posta veya push entegre edin.");return}c(""),r(""),d("G\xf6nderildi.")}return(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h3",{children:"\uD83D\uDCE3 Bildiri G\xf6nder"}),(0,s.jsx)("div",{className:"row",style:{marginTop:8},children:(0,s.jsx)("input",{className:"input",style:{flex:1},placeholder:"Başlık",value:t,onChange:e=>c(e.target.value)})}),(0,s.jsx)("div",{className:"row",style:{marginTop:8},children:(0,s.jsx)("textarea",{className:"input",rows:5,style:{width:"100%"},placeholder:"Mesaj i\xe7eriği",value:n,onChange:e=>r(e.target.value)})}),(0,s.jsxs)("div",{className:"row",style:{marginTop:8},children:[(0,s.jsx)("button",{className:"btn",onClick:o,children:"G\xf6nder"}),l&&(0,s.jsx)("div",{className:"muted",children:l})]})]})}},9008:function(e,a,t){e.exports=t(3867)}},function(e){e.O(0,[645,941,888,774,179],function(){return e(e.s=7953)}),_N_E=e.O()}]);