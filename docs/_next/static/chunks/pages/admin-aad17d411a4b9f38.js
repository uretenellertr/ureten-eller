(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{7953:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return t(1430)}])},1430:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return h}});var s=t(5893),c=t(645),n=t.n(c),r=t(7294),i=t(9008),d=t.n(i),l=t(4941);let o=null,x=e=>e?new Date(e).toLocaleString():"",u=e=>e?"Evet":"Hayır";function h(){let e=function(){if(o)return o;let e="https://krmjbjfwmnhzfhnrswgg.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtybWpiamZ3bW5oemZobnJzd2dnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3NjQ2NjYsImV4cCI6MjA3NTM0MDY2Nn0.cuM0AjBKOND7Q95Zjyp8jX9QoLI51OFfq4uJRkQmfM4";return e&&a?o=(0,l.eI)(e,a):null}(),[a,t]=(0,r.useState)(null),[c,i]=(0,r.useState)(null),[x,u]=(0,r.useState)(!0),[h,v]=(0,r.useState)("inbox"),[y,w]=(0,r.useState)(""),k=(0,r.useRef)(null),[_,N]=(0,r.useState)({pending:0,inbox:0,complaints:0}),C=(0,r.useRef)(_);(0,r.useEffect)(()=>{let a=!0;return(async()=>{try{if(!e){w("Supabase yapılandırması eksik."),u(!1);return}let{data:{user:s}}=await e.auth.getUser();if(!a)return;if(!s){w("\xd6nce giriş yapın."),u(!1);return}t(s);let{data:c,error:n}=await e.from("users").select("role").eq("auth_user_id",s.id).single();if(n){w("Kullanıcı rol\xfc okunamadı."),u(!1);return}i((null==c?void 0:c.role)||null)}catch(e){w((null==e?void 0:e.message)||"Hata")}finally{a&&u(!1)}})(),()=>{a=!1}},[e]);let z=!x&&"admin"!==c;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(d(),{children:[(0,s.jsx)("title",{className:"jsx-d534672ac59d33c7",children:"Admin – \xdcreten Eller"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1",className:"jsx-d534672ac59d33c7"})]}),(0,s.jsx)("audio",{ref:k,src:"/notify.wav",preload:"auto",className:"jsx-d534672ac59d33c7"}),(0,s.jsxs)("div",{className:"jsx-d534672ac59d33c7 admin",children:[(0,s.jsxs)("aside",{className:"jsx-d534672ac59d33c7 side",children:[(0,s.jsxs)("div",{className:"jsx-d534672ac59d33c7 brand",children:[(0,s.jsx)("img",{src:"/logo.png",width:"28",height:"28",alt:"logo",className:"jsx-d534672ac59d33c7"}),(0,s.jsx)("b",{className:"jsx-d534672ac59d33c7",children:"Y\xf6netim"})]}),(0,s.jsxs)("nav",{className:"jsx-d534672ac59d33c7 menu",children:[(0,s.jsxs)("button",{onClick:()=>v("inbox"),className:"jsx-d534672ac59d33c7 "+(("inbox"===h?"on":"")||""),children:[(0,s.jsx)("span",{className:"jsx-d534672ac59d33c7",children:"\uD83D\uDCAC"})," Mesajlar"]}),(0,s.jsxs)("button",{onClick:()=>v("pending"),className:"jsx-d534672ac59d33c7 "+(("pending"===h?"on":"")||""),children:[(0,s.jsx)("span",{className:"jsx-d534672ac59d33c7",children:"\uD83D\uDCDD"})," İlan Onayı"]}),(0,s.jsxs)("button",{onClick:()=>v("showcase"),className:"jsx-d534672ac59d33c7 "+(("showcase"===h?"on":"")||""),children:[(0,s.jsx)("span",{className:"jsx-d534672ac59d33c7",children:"✨"})," Vitrin / PRO"]}),(0,s.jsxs)("button",{onClick:()=>v("users"),className:"jsx-d534672ac59d33c7 "+(("users"===h?"on":"")||""),children:[(0,s.jsx)("span",{className:"jsx-d534672ac59d33c7",children:"\uD83D\uDC65"})," Kullanıcılar"]}),(0,s.jsxs)("button",{onClick:()=>v("complaints"),className:"jsx-d534672ac59d33c7 "+(("complaints"===h?"on":"")||""),children:[(0,s.jsx)("span",{className:"jsx-d534672ac59d33c7",children:"\uD83D\uDEA9"})," Şikayetler"]}),(0,s.jsxs)("button",{onClick:()=>v("broadcast"),className:"jsx-d534672ac59d33c7 "+(("broadcast"===h?"on":"")||""),children:[(0,s.jsx)("span",{className:"jsx-d534672ac59d33c7",children:"\uD83D\uDCE3"})," Bildiri G\xf6nder"]})]}),(0,s.jsxs)("div",{className:"jsx-d534672ac59d33c7 foot",children:[a?(0,s.jsx)("small",{className:"jsx-d534672ac59d33c7",children:a.email}):null,(0,s.jsx)("button",{onClick:async()=>{try{await e.auth.signOut()}catch(e){}window.location.href="/login"},className:"jsx-d534672ac59d33c7 logout",children:"\xc7ıkış"})]})]}),(0,s.jsxs)("main",{className:"jsx-d534672ac59d33c7 main",children:[x&&(0,s.jsx)("div",{className:"jsx-d534672ac59d33c7 card",children:(0,s.jsx)("div",{className:"jsx-d534672ac59d33c7 muted",children:"Y\xfckleniyor…"})}),z&&(0,s.jsx)("div",{className:"jsx-d534672ac59d33c7 card err",children:"Bu sayfayı sadece admin g\xf6rebilir."}),!!y&&!x&&!z&&(0,s.jsx)("div",{className:"jsx-d534672ac59d33c7 card err",children:y}),!x&&"admin"===c&&(0,s.jsxs)(s.Fragment,{children:["inbox"===h&&(0,s.jsx)(m,{supa:e,audioRef:k,counts:_,setCounts:N,lastCounts:C}),"pending"===h&&(0,s.jsx)(p,{supa:e,audioRef:k,counts:_,setCounts:N,lastCounts:C}),"showcase"===h&&(0,s.jsx)(b,{supa:e}),"users"===h&&(0,s.jsx)(j,{supa:e}),"complaints"===h&&(0,s.jsx)(f,{supa:e,audioRef:k,counts:_,setCounts:N,lastCounts:C}),"broadcast"===h&&(0,s.jsx)(g,{supa:e})]})]})]}),(0,s.jsx)(n(),{id:"d534672ac59d33c7",children:'.jsx-d534672ac59d33c7:root{--bg:#0b0b0b;--ink:#f8fafc;--muted:#cbd5e1;--line:#222;--accent:#d4a373;--accent-soft:rgba(212,163,115,.35)}html.jsx-d534672ac59d33c7,body.jsx-d534672ac59d33c7,#__next.jsx-d534672ac59d33c7{height:100%}body.jsx-d534672ac59d33c7{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}.admin.jsx-d534672ac59d33c7{display:grid;grid-template-columns:280px 1fr;min-height:100vh}.side.jsx-d534672ac59d33c7{background:#0e0e0e;color:var(--ink);display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;padding:14px;gap:14px;border-right:2px solid var(--accent);-webkit-box-shadow:0 0 0 1px var(--accent)inset,0 0 18px var(--accent-soft);-moz-box-shadow:0 0 0 1px var(--accent)inset,0 0 18px var(--accent-soft);box-shadow:0 0 0 1px var(--accent)inset,0 0 18px var(--accent-soft)}.brand.jsx-d534672ac59d33c7{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:10px;font-size:18px}.menu.jsx-d534672ac59d33c7{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;-moz-box-orient:vertical;-moz-box-direction:normal;-ms-flex-direction:column;flex-direction:column;gap:8px}.menu.jsx-d534672ac59d33c7 button.jsx-d534672ac59d33c7{all:unset;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:10px;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;padding:10px 12px;-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;cursor:pointer;color:var(--ink);border:2px solid var(--accent);background:-webkit-linear-gradient(top,rgba(212,163,115,.08),rgba(212,163,115,.02));background:-moz-linear-gradient(top,rgba(212,163,115,.08),rgba(212,163,115,.02));background:-o-linear-gradient(top,rgba(212,163,115,.08),rgba(212,163,115,.02));background:linear-gradient(180deg,rgba(212,163,115,.08),rgba(212,163,115,.02));-webkit-box-shadow:0 0 0 1px var(--accent)inset,0 0 10px var(--accent-soft);-moz-box-shadow:0 0 0 1px var(--accent)inset,0 0 10px var(--accent-soft);box-shadow:0 0 0 1px var(--accent)inset,0 0 10px var(--accent-soft);-webkit-transition:.2s;-moz-transition:.2s;-o-transition:.2s;transition:.2s}.menu.jsx-d534672ac59d33c7 button.on.jsx-d534672ac59d33c7{background:var(--accent);color:#0b0b0b;font-weight:900}.menu.jsx-d534672ac59d33c7 button.jsx-d534672ac59d33c7:hover{-webkit-transform:translatex(2px);-moz-transform:translatex(2px);-ms-transform:translatex(2px);-o-transform:translatex(2px);transform:translatex(2px);-webkit-box-shadow:0 0 0 1px var(--accent)inset,0 0 16px var(--accent-soft);-moz-box-shadow:0 0 0 1px var(--accent)inset,0 0 16px var(--accent-soft);box-shadow:0 0 0 1px var(--accent)inset,0 0 16px var(--accent-soft)}.foot.jsx-d534672ac59d33c7{margin-top:auto;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px}.logout.jsx-d534672ac59d33c7{all:unset;border:2px solid var(--accent);background:transparent;color:var(--ink);padding:8px 12px;-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;cursor:pointer;-webkit-box-shadow:0 0 0 1px var(--accent)inset,0 0 12px var(--accent-soft);-moz-box-shadow:0 0 0 1px var(--accent)inset,0 0 12px var(--accent-soft);box-shadow:0 0 0 1px var(--accent)inset,0 0 12px var(--accent-soft)}.main.jsx-d534672ac59d33c7{padding:16px;display:grid;gap:16px;-webkit-align-content:start;-ms-flex-line-pack:start;align-content:start}.card.jsx-d534672ac59d33c7{-webkit-border-radius:18px;-moz-border-radius:18px;border-radius:18px;padding:16px;border:2px solid var(--accent);-webkit-box-shadow:0 0 0 1px var(--accent)inset,0 0 18px var(--accent-soft);-moz-box-shadow:0 0 0 1px var(--accent)inset,0 0 18px var(--accent-soft);box-shadow:0 0 0 1px var(--accent)inset,0 0 18px var(--accent-soft);background:rgba(20,20,20,.92)}.muted.jsx-d534672ac59d33c7{color:var(--muted)}.err.jsx-d534672ac59d33c7{background:#2a0f0f;border-color:#f99;color:#ffd1d1}.row.jsx-d534672ac59d33c7{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:8px;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center}.input.jsx-d534672ac59d33c7,input[type="text"].jsx-d534672ac59d33c7,input[type="number"].jsx-d534672ac59d33c7,input[type="email"].jsx-d534672ac59d33c7,input[type="password"].jsx-d534672ac59d33c7,textarea.jsx-d534672ac59d33c7,select.jsx-d534672ac59d33c7{border:2px solid var(--accent);background:#0f0f0f;color:var(--ink);-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;padding:10px 12px;outline:none;-webkit-box-shadow:0 0 0 1px var(--accent)inset,0 0 10px var(--accent-soft);-moz-box-shadow:0 0 0 1px var(--accent)inset,0 0 10px var(--accent-soft);box-shadow:0 0 0 1px var(--accent)inset,0 0 10px var(--accent-soft)}.jsx-d534672ac59d33c7::-webkit-input-placeholder{color:#9aa4b2}.jsx-d534672ac59d33c7:-moz-placeholder{color:#9aa4b2}.jsx-d534672ac59d33c7::-moz-placeholder{color:#9aa4b2}.jsx-d534672ac59d33c7:-ms-input-placeholder{color:#9aa4b2}.jsx-d534672ac59d33c7::-ms-input-placeholder{color:#9aa4b2}.jsx-d534672ac59d33c7::placeholder{color:#9aa4b2}select.jsx-d534672ac59d33c7 option.jsx-d534672ac59d33c7{background:#fff;color:#111}.btn.jsx-d534672ac59d33c7{border:2px solid var(--accent);background:transparent;color:var(--ink);padding:8px 12px;-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;font-weight:800;cursor:pointer;-webkit-box-shadow:0 0 0 1px var(--accent)inset,0 0 12px var(--accent-soft);-moz-box-shadow:0 0 0 1px var(--accent)inset,0 0 12px var(--accent-soft);box-shadow:0 0 0 1px var(--accent)inset,0 0 12px var(--accent-soft);-webkit-transition:.2s;-moz-transition:.2s;-o-transition:.2s;transition:.2s}.btn.jsx-d534672ac59d33c7:hover{-webkit-transform:translatey(-1px);-moz-transform:translatey(-1px);-ms-transform:translatey(-1px);-o-transform:translatey(-1px);transform:translatey(-1px);-webkit-box-shadow:0 0 0 1px var(--accent)inset,0 0 16px var(--accent-soft);-moz-box-shadow:0 0 0 1px var(--accent)inset,0 0 16px var(--accent-soft);box-shadow:0 0 0 1px var(--accent)inset,0 0 16px var(--accent-soft)}.btn.primary.jsx-d534672ac59d33c7{background:var(--accent);color:#0b0b0b}.ghost.jsx-d534672ac59d33c7{border:2px solid var(--accent);background:transparent;color:var(--ink);padding:6px 10px;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;cursor:pointer}table.jsx-d534672ac59d33c7{width:100%;border-collapse:separate;border-spacing:0}thead.jsx-d534672ac59d33c7 th.jsx-d534672ac59d33c7{text-align:left;font-weight:900;padding:10px 12px;background:#131313;color:var(--ink);border-bottom:2px solid var(--accent)}tbody.jsx-d534672ac59d33c7 td.jsx-d534672ac59d33c7{padding:10px 12px;color:var(--ink);border-bottom:1px solid#1a1a1a}tbody.jsx-d534672ac59d33c7 tr.jsx-d534672ac59d33c7{background:rgba(255,255,255,.02);border-left:2px solid var(--accent);border-right:2px solid var(--accent)}tbody.jsx-d534672ac59d33c7 tr.jsx-d534672ac59d33c7:first-child{border-top:2px solid var(--accent)}tbody.jsx-d534672ac59d33c7 tr.jsx-d534672ac59d33c7:last-child{border-bottom:2px solid var(--accent)}tbody.jsx-d534672ac59d33c7 tr.jsx-d534672ac59d33c7:hover{background:rgba(212,163,115,.08);-webkit-box-shadow:inset 0 0 12px var(--accent-soft);-moz-box-shadow:inset 0 0 12px var(--accent-soft);box-shadow:inset 0 0 12px var(--accent-soft)}@media(max-width:980px){.admin.jsx-d534672ac59d33c7{grid-template-columns:1fr}.side.jsx-d534672ac59d33c7{position:-webkit-sticky;position:sticky;top:0;z-index:40}.main.jsx-d534672ac59d33c7{padding:10px}}'})]})}function m(e){let{supa:a,audioRef:t,counts:c,setCounts:n,lastCounts:i}=e,[d,l]=(0,r.useState)([]),[o,u]=(0,r.useState)(null),[h,m]=(0,r.useState)([]),[p,b]=(0,r.useState)(""),[j,f]=(0,r.useState)(""),g=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let{data:s}=await a.from("conversations").select("id,buyer_auth_id,seller_auth_id,created_at").order("id",{ascending:!1}).limit(50);l(s||[]);let r={...c,inbox:(s||[]).length};n(r),e&&t.current&&r.inbox>(i.current.inbox||0)&&(t.current.currentTime=0,t.current.play().catch(()=>{})),i.current=r}catch(e){}},[a,c,n,t]),v=(0,r.useCallback)(async e=>{u(e);let{data:t}=await a.from("messages").select("id,conv_id,sender_auth_id,receiver_auth_id,body,created_at").eq("conv_id",e).order("created_at",{ascending:!0}).limit(200);m(t||[])},[a]);async function y(){f("");let e=p.trim();if(o&&e)try{let t=h[h.length-1],s=t?t.sender_auth_id:null;if(!s){f("Alıcı belirlenemedi.");return}let{data:{user:c}}=await a.auth.getUser(),n={conv_id:o,sender_auth_id:c.id,receiver_auth_id:s,body:e},{error:r}=await a.from("messages").insert(n);if(r)throw r;b(""),await v(o)}catch(e){f((null==e?void 0:e.message)||"G\xf6nderilemedi")}}async function w(e){f("");try{let{error:t}=await a.rpc("admin_message_delete_hard",{p_msg_id:e});if(t)throw t;m(a=>a.filter(a=>a.id!==e))}catch(e){f((null==e?void 0:e.message)||"Silinemedi")}}return(0,r.useEffect)(()=>{g(!1)},[g]),(0,r.useEffect)(()=>{let e=setInterval(()=>g(!0),1e4);return()=>clearInterval(e)},[g]),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,s.jsx)("h3",{children:"\uD83D\uDCAC Mesajlar"}),(0,s.jsx)("button",{className:"ghost",onClick:()=>g(!0),children:"Yenile"})]}),(0,s.jsxs)("div",{className:"grid2",children:[(0,s.jsx)("div",{children:(0,s.jsxs)("table",{className:"table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"ID"}),(0,s.jsx)("th",{children:"Alıcı/Satıcı"}),(0,s.jsx)("th",{children:"Oluşturulma"}),(0,s.jsx)("th",{})]})}),(0,s.jsxs)("tbody",{children:[(d||[]).map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{children:["#",e.id]}),(0,s.jsxs)("td",{style:{fontSize:12},children:[(0,s.jsxs)("div",{children:["buyer: ",(0,s.jsx)("code",{children:e.buyer_auth_id})]}),(0,s.jsxs)("div",{children:["seller: ",(0,s.jsx)("code",{children:e.seller_auth_id})]})]}),(0,s.jsx)("td",{children:x(e.created_at)}),(0,s.jsx)("td",{children:(0,s.jsx)("button",{className:"btn",onClick:()=>v(e.id),children:"A\xe7"})})]},e.id)),!(null==d?void 0:d.length)&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:4,className:"muted",children:"Konuşma yok."})})]})]})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,s.jsxs)("h4",{children:["Konuşma #",o||"-"]}),(0,s.jsxs)("span",{className:"muted",children:[h.length," mesaj"]})]}),(0,s.jsxs)("div",{style:{maxHeight:360,overflow:"auto",border:"2px solid var(--accent)",borderRadius:10,padding:10,boxShadow:"0 0 0 1px var(--accent) inset, 0 0 10px var(--accent-soft)"},children:[h.map(e=>(0,s.jsxs)("div",{style:{borderBottom:"1px dashed #3a3a3a",padding:"6px 0"},children:[(0,s.jsxs)("div",{style:{fontSize:12,color:"#aab4c0"},children:["#",e.id," • ",x(e.created_at)]}),(0,s.jsxs)("div",{style:{fontSize:12,margin:"4px 0"},children:[(0,s.jsx)("b",{children:"from"})," ",(0,s.jsx)("code",{children:e.sender_auth_id})," → ",(0,s.jsx)("b",{children:"to"})," ",(0,s.jsx)("code",{children:e.receiver_auth_id})]}),(0,s.jsx)("div",{children:e.body}),(0,s.jsx)("div",{className:"row",style:{marginTop:6},children:(0,s.jsx)("button",{className:"ghost",onClick:()=>w(e.id),children:"Kalıcı Sil"})})]},e.id)),!h.length&&(0,s.jsx)("div",{className:"muted",children:"Mesaj yok."})]}),(0,s.jsxs)("div",{className:"row",style:{marginTop:10},children:[(0,s.jsx)("input",{className:"input",style:{flex:1},placeholder:"Yanıt yaz…",value:p,onChange:e=>b(e.target.value)}),(0,s.jsx)("button",{className:"btn",onClick:y,children:"G\xf6nder"})]}),j&&(0,s.jsx)("div",{className:"card",style:{marginTop:8,background:"#2a0f0f",borderColor:"#ff9999",color:"#ffd1d1"},children:j})]})]})]})}function p(e){let{supa:a,audioRef:t,counts:c,setCounts:n,lastCounts:i}=e,[d,l]=(0,r.useState)([]),o=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{data:s}=await a.from("listings").select("id,title,created_at,city,district,price,currency,status,expires_at,is_showcase").in("status",["pending"]).order("created_at",{ascending:!1}).limit(100);l(s||[]);let r={...c,pending:(s||[]).length};n(r),e&&t.current&&r.pending>(i.current.pending||0)&&(t.current.currentTime=0,t.current.play().catch(()=>{})),i.current=r},[a,c,n,t]);async function x(e){let{error:t}=await a.from("listings").update({status:"active"}).eq("id",e);t||l(a=>a.filter(a=>a.id!==e))}async function u(e){let{error:t}=await a.from("listings").update({status:"rejected"}).eq("id",e);t||l(a=>a.filter(a=>a.id!==e))}return(0,r.useEffect)(()=>{o(!1)},[o]),(0,r.useEffect)(()=>{let e=setInterval(()=>o(!0),1e4);return()=>clearInterval(e)},[o]),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,s.jsx)("h3",{children:"\uD83D\uDCDD Onay Bekleyen İlanlar"}),(0,s.jsx)("button",{className:"ghost",onClick:()=>o(!0),children:"Yenile"})]}),(0,s.jsxs)("table",{className:"table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"ID"}),(0,s.jsx)("th",{children:"Başlık"}),(0,s.jsx)("th",{children:"Konum"}),(0,s.jsx)("th",{children:"Fiyat"}),(0,s.jsx)("th",{children:"Durum"}),(0,s.jsx)("th",{children:"İşlem"})]})}),(0,s.jsxs)("tbody",{children:[(d||[]).map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{children:["#",e.id]}),(0,s.jsx)("td",{children:e.title}),(0,s.jsxs)("td",{children:[e.city," ",e.district?"/ ".concat(e.district):""]}),(0,s.jsx)("td",{children:e.price?"".concat(e.price," ").concat(e.currency||"TRY"):"-"}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{children:"pending"})}),(0,s.jsxs)("td",{className:"row",children:[(0,s.jsx)("button",{className:"btn",onClick:()=>x(e.id),children:"Onayla"}),(0,s.jsx)("button",{className:"ghost",onClick:()=>u(e.id),children:"Reddet"})]})]},e.id)),!(null==d?void 0:d.length)&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:6,className:"muted",children:"Bekleyen ilan yok."})})]})]})]})}function b(e){let{supa:a}=e,[t,c]=(0,r.useState)([]),[n,i]=(0,r.useState)(""),d=(0,r.useCallback)(async()=>{let{data:e}=await a.from("listings").select("id,title,is_showcase,created_at,price,currency,city,status").eq("status","active").order("created_at",{ascending:!1}).limit(100);c(e||[])},[a]);async function l(e){i("");let{error:t}=await a.from("listings").update({is_showcase:!e.is_showcase}).eq("id",e.id);t?i(t.message):d()}return(0,r.useEffect)(()=>{d()},[d]),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,s.jsx)("h3",{children:"✨ Vitrin / PRO"}),(0,s.jsx)("button",{className:"ghost",onClick:()=>d(),children:"Yenile"})]}),n&&(0,s.jsx)("div",{className:"card",style:{marginBottom:8,background:"#2a0f0f",borderColor:"#ff9999",color:"#ffd1d1"},children:n}),(0,s.jsxs)("table",{className:"table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"ID"}),(0,s.jsx)("th",{children:"Başlık"}),(0,s.jsx)("th",{children:"Fiyat"}),(0,s.jsx)("th",{children:"Konum"}),(0,s.jsx)("th",{children:"Vitrin"}),(0,s.jsx)("th",{})]})}),(0,s.jsxs)("tbody",{children:[(t||[]).map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{children:["#",e.id]}),(0,s.jsx)("td",{children:e.title}),(0,s.jsx)("td",{children:e.price?"".concat(e.price," ").concat(e.currency||"TRY"):"-"}),(0,s.jsx)("td",{children:e.city||"-"}),(0,s.jsx)("td",{children:u(e.is_showcase)}),(0,s.jsx)("td",{children:(0,s.jsx)("button",{className:"btn",onClick:()=>l(e),children:e.is_showcase?"Vitrinden \xc7ıkar":"Vitrine Ekle"})})]},e.id)),!(null==t?void 0:t.length)&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:6,className:"muted",children:"Aktif ilan yok."})})]})]})]})}function j(e){let{supa:a}=e,[t,c]=(0,r.useState)([]),[n,i]=(0,r.useState)(12),[d,l]=(0,r.useState)(""),o=(0,r.useCallback)(async()=>{let{data:e}=await a.from("users").select("auth_user_id, email, full_name, role, premium_until, created_at").order("created_at",{ascending:!1}).limit(200);c(e||[])},[a]);async function u(e,t){l("");let{error:s}=await a.from("users").update({role:t}).eq("auth_user_id",e);s?l(s.message):o()}async function h(e){l("");let t=Number(n)||12;if((await a.rpc("admin_grant_pro",{p_user_id:e,p_months:t})).error){let{data:s}=await a.from("users").select("premium_until").eq("auth_user_id",e).single(),c=new Date,n=(null==s?void 0:s.premium_until)?new Date(s.premium_until):c,r=new Date(n>c?n:c);r.setMonth(r.getMonth()+t);let i=r.toISOString(),{error:d}=await a.from("users").update({premium_until:i}).eq("auth_user_id",e);if(d){l(d.message);return}}o()}return(0,r.useEffect)(()=>{o()},[o]),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,s.jsx)("h3",{children:"\uD83D\uDC65 Kullanıcılar"}),(0,s.jsx)("button",{className:"ghost",onClick:()=>o(),children:"Yenile"})]}),d&&(0,s.jsx)("div",{className:"card",style:{marginBottom:8,background:"#2a0f0f",borderColor:"#ff9999",color:"#ffd1d1"},children:d}),(0,s.jsxs)("div",{className:"row",style:{marginBottom:8},children:[(0,s.jsx)("label",{children:"PRO ay (varsayılan 12):"}),(0,s.jsx)("input",{className:"input",style:{width:90},type:"number",min:"1",max:"36",value:n,onChange:e=>i(e.target.value)})]}),(0,s.jsxs)("table",{className:"table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"E-posta"}),(0,s.jsx)("th",{children:"Ad"}),(0,s.jsx)("th",{children:"Rol"}),(0,s.jsx)("th",{children:"PRO Bitiş"}),(0,s.jsx)("th",{children:"Kayıt"}),(0,s.jsx)("th",{children:"İşlem"})]})}),(0,s.jsxs)("tbody",{children:[(t||[]).map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:e.email||"-"}),(0,s.jsx)("td",{children:e.full_name||"-"}),(0,s.jsx)("td",{children:(0,s.jsx)("b",{children:e.role||"user"})}),(0,s.jsx)("td",{children:e.premium_until?x(e.premium_until):"—"}),(0,s.jsx)("td",{children:x(e.created_at)}),(0,s.jsxs)("td",{className:"row",children:[(0,s.jsx)("button",{className:"ghost",onClick:()=>u(e.auth_user_id,"user"),children:"user"}),(0,s.jsx)("button",{className:"ghost",onClick:()=>u(e.auth_user_id,"moderator"),children:"moderator"}),(0,s.jsx)("button",{className:"ghost",onClick:()=>u(e.auth_user_id,"admin"),children:"admin"}),(0,s.jsxs)("button",{className:"btn",onClick:()=>h(e.auth_user_id),children:["PRO Ver (+",n," ay)"]})]})]},e.auth_user_id)),!(null==t?void 0:t.length)&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:6,className:"muted",children:"Kayıt yok."})})]})]})]})}function f(e){let{supa:a,audioRef:t,counts:c,setCounts:n,lastCounts:i}=e,[d,l]=(0,r.useState)([]),[o,x]=(0,r.useState)(""),u=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let{data:s,error:r}=await a.from("reports").select("id, created_at, type, ref_id, reporter_auth_id, note, status");if(r){l([]);return}l(s||[]);let d={...c,complaints:(s||[]).length};n(d),e&&t.current&&d.complaints>(i.current.complaints||0)&&(t.current.currentTime=0,t.current.play().catch(()=>{})),i.current=d}catch(e){l([])}},[a,c,n,t]);async function h(e,t){x("");let{error:s}=await a.from("reports").update({status:t}).eq("id",e);s?x(s.message):u(!1)}return(0,r.useEffect)(()=>{u(!1)},[u]),(0,r.useEffect)(()=>{let e=setInterval(()=>u(!0),15e3);return()=>clearInterval(e)},[u]),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,s.jsx)("h3",{children:"\uD83D\uDEA9 Şikayetler"}),(0,s.jsx)("button",{className:"ghost",onClick:()=>u(!0),children:"Yenile"})]}),o&&(0,s.jsx)("div",{className:"card",style:{marginBottom:8,background:"#2a0f0f",borderColor:"#ff9999",color:"#ffd1d1"},children:o}),(0,s.jsxs)("table",{className:"table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"ID"}),(0,s.jsx)("th",{children:"T\xfcr"}),(0,s.jsx)("th",{children:"Referans"}),(0,s.jsx)("th",{children:"Rapor Eden"}),(0,s.jsx)("th",{children:"Not"}),(0,s.jsx)("th",{children:"Durum"}),(0,s.jsx)("th",{})]})}),(0,s.jsxs)("tbody",{children:[(d||[]).map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{children:["#",e.id]}),(0,s.jsx)("td",{children:e.type||"-"}),(0,s.jsx)("td",{children:e.ref_id||"-"}),(0,s.jsx)("td",{children:(0,s.jsx)("code",{children:e.reporter_auth_id})}),(0,s.jsx)("td",{children:e.note||"-"}),(0,s.jsx)("td",{children:e.status||"open"}),(0,s.jsxs)("td",{className:"row",children:[(0,s.jsx)("button",{className:"ghost",onClick:()=>h(e.id,"in_review"),children:"İncele"}),(0,s.jsx)("button",{className:"btn",onClick:()=>h(e.id,"closed"),children:"Kapattım"})]})]},e.id)),!(null==d?void 0:d.length)&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,className:"muted",children:"Şikayet yok (veya tablo yok)."})})]})]})]})}function g(e){let{supa:a}=e,[t,c]=(0,r.useState)(""),[n,i]=(0,r.useState)(""),[d,l]=(0,r.useState)("");async function o(){if(l(""),!t.trim()||!n.trim()){l("Başlık ve mesaj zorunlu.");return}let{error:e}=await a.from("broadcasts").insert({title:t,body:n});if(e){l("Broadcast tablosu yoksa: admin kullanıcılarına e-posta veya push entegre edin.");return}c(""),i(""),l("G\xf6nderildi.")}return(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h3",{children:"\uD83D\uDCE3 Bildiri G\xf6nder"}),(0,s.jsx)("div",{className:"row",style:{marginTop:8},children:(0,s.jsx)("input",{className:"input",style:{flex:1},placeholder:"Başlık",value:t,onChange:e=>c(e.target.value)})}),(0,s.jsx)("div",{className:"row",style:{marginTop:8},children:(0,s.jsx)("textarea",{className:"input",rows:5,style:{width:"100%"},placeholder:"Mesaj i\xe7eriği",value:n,onChange:e=>i(e.target.value)})}),(0,s.jsxs)("div",{className:"row",style:{marginTop:8},children:[(0,s.jsx)("button",{className:"btn primary",onClick:o,children:"G\xf6nder"}),d&&(0,s.jsx)("div",{className:"muted",children:d})]})]})}},9008:function(e,a,t){e.exports=t(3867)}},function(e){e.O(0,[645,941,888,774,179],function(){return e(e.s=7953)}),_N_E=e.O()}]);