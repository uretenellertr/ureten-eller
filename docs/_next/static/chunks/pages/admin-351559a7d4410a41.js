(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{3454:function(e,t,s){"use strict";var i,n;e.exports=(null==(i=s.g.process)?void 0:i.env)&&"object"==typeof(null==(n=s.g.process)?void 0:n.env)?s.g.process:s(7663)},7953:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return s(1430)}])},1430:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return u}});var i=s(5893),n=s(7294),a=s(9008),l=s.n(a),r=s(4941);let c=null,d=e=>e?new Date(e).toLocaleString():"",o=e=>e?"Evet":"Hayır";function u(){let e=function(){if(c)return c;let e="https://krmjbjfwmnhzfhnrswgg.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtybWpiamZ3bW5oemZobnJzd2dnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3NjQ2NjYsImV4cCI6MjA3NTM0MDY2Nn0.cuM0AjBKOND7Q95Zjyp8jX9QoLI51OFfq4uJRkQmfM4";return e&&t?c=(0,r.eI)(e,t):null}(),[t,s]=(0,n.useState)(null),[a,d]=(0,n.useState)(null),[o,u]=(0,n.useState)(!0),[_,v]=(0,n.useState)("support"),[b,g]=(0,n.useState)(""),N=(0,n.useRef)(null);(0,n.useEffect)(()=>{let t=!0;return(async()=>{try{if(!e){g("Supabase yapılandırması eksik."),u(!1);return}let{data:{user:i}}=await e.auth.getUser();if(!t)return;if(!i){g("\xd6nce giriş yapın."),u(!1);return}s(i);let{data:n,error:a}=await e.from("users").select("role").eq("auth_user_id",i.id).single();if(a){g("Kullanıcı rol\xfc okunamadı."),u(!1);return}d((null==n?void 0:n.role)||null)}catch(e){g((null==e?void 0:e.message)||"Hata")}finally{t&&u(!1)}})(),()=>{t=!1}},[e]);let w=!o&&"admin"!==a;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(l(),{children:[(0,i.jsx)("link",{rel:"stylesheet",href:"/admin-dark.css?v=2"}),(0,i.jsx)("title",{children:"Admin – \xdcreten Eller"}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})]}),(0,i.jsx)("audio",{ref:N,src:"/notify.wav",preload:"auto"}),(0,i.jsxs)("div",{className:"admin",children:[(0,i.jsxs)("aside",{className:"side",children:[(0,i.jsxs)("div",{className:"brand",children:[(0,i.jsx)("img",{src:"/logo.png",width:"28",height:"28",alt:"logo"}),(0,i.jsx)("b",{children:"Y\xf6netim"})]}),(0,i.jsxs)("nav",{className:"menu",children:[(0,i.jsxs)("button",{className:"support"===_?"on":"",onClick:()=>v("support"),children:[(0,i.jsx)("span",{children:"\uD83D\uDCDE"})," Canlı Destek"]}),(0,i.jsxs)("button",{className:"usermsgs"===_?"on":"",onClick:()=>v("usermsgs"),children:[(0,i.jsx)("span",{children:"\uD83D\uDCAC"})," Kullanıcı Mesajları"]}),(0,i.jsxs)("button",{className:"pending"===_?"on":"",onClick:()=>v("pending"),children:[(0,i.jsx)("span",{children:"\uD83D\uDCDD"})," İlan Onayı"]}),(0,i.jsxs)("button",{className:"showcase"===_?"on":"",onClick:()=>v("showcase"),children:[(0,i.jsx)("span",{children:"✨"})," Vitrin / PRO"]}),(0,i.jsxs)("button",{className:"users"===_?"on":"",onClick:()=>v("users"),children:[(0,i.jsx)("span",{children:"\uD83D\uDC65"})," Kullanıcılar"]}),(0,i.jsxs)("button",{className:"complaints"===_?"on":"",onClick:()=>v("complaints"),children:[(0,i.jsx)("span",{children:"\uD83D\uDEA9"})," Şikayetler"]}),(0,i.jsxs)("button",{className:"broadcast"===_?"on":"",onClick:()=>v("broadcast"),children:[(0,i.jsx)("span",{children:"\uD83D\uDCE3"})," Bildiri G\xf6nder"]})]}),(0,i.jsxs)("div",{className:"foot",children:[t?(0,i.jsx)("small",{children:t.email}):null,(0,i.jsx)("button",{className:"logout",onClick:async()=>{try{await e.auth.signOut()}catch(e){}window.location.href="/login"},children:"\xc7ıkış"})]})]}),(0,i.jsxs)("main",{className:"main",children:[o&&(0,i.jsx)("div",{className:"card",children:(0,i.jsx)("div",{className:"muted",children:"Y\xfckleniyor…"})}),w&&(0,i.jsx)("div",{className:"card err",children:"Bu sayfayı sadece admin g\xf6rebilir."}),!!b&&!o&&!w&&(0,i.jsx)("div",{className:"card err",children:b}),!o&&"admin"===a&&(0,i.jsxs)(i.Fragment,{children:["support"===_&&(0,i.jsx)(h,{supa:e,audioRef:N,me:t}),"usermsgs"===_&&(0,i.jsx)(m,{supa:e,audioRef:N}),"pending"===_&&(0,i.jsx)(j,{supa:e}),"showcase"===_&&(0,i.jsx)(x,{supa:e}),"users"===_&&(0,i.jsx)(f,{supa:e}),"complaints"===_&&(0,i.jsx)(p,{supa:e,audioRef:N}),"broadcast"===_&&(0,i.jsx)(y,{supa:e})]})]})]})]})}function h(e){let{supa:t,audioRef:s,me:a}=e,[l,r]=(0,n.useState)([]),[c,o]=(0,n.useState)(null),[u,h]=(0,n.useState)([]),[m,j]=(0,n.useState)(""),[x,f]=(0,n.useState)(""),[p,y]=(0,n.useState)({}),_=null==a?void 0:a.id,v=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!_)return;let{data:i}=await t.from("conversations").select("id,buyer_auth_id,seller_auth_id,created_at").or("buyer_auth_id.eq.".concat(_,",seller_auth_id.eq.").concat(_)).order("id",{ascending:!1}).limit(200);if(r(i||[]),e&&s.current)try{s.current.currentTime=0,s.current.play()}catch(e){}},[t,_,s]),b=(0,n.useCallback)(async e=>{o(e);let{data:s}=await t.from("messages").select("id,conv_id,sender_auth_id,receiver_auth_id,body,created_at").eq("conv_id",e).order("created_at",{ascending:!0}).limit(500);h(s||[]),y({})},[t]);async function g(){f("");let e=m.trim();if(c&&e)try{let s=u[u.length-1],i=s?s.sender_auth_id:null;if(!i){let e=l.find(e=>e.id===c);if(!e){f("Konuşma bulunamadı.");return}i=e.buyer_auth_id===_?e.seller_auth_id:e.buyer_auth_id}let n={conv_id:c,sender_auth_id:_,receiver_auth_id:i,body:e},{error:a}=await t.from("messages").insert(n);if(a)throw a;j(""),await b(c)}catch(e){f((null==e?void 0:e.message)||"G\xf6nderilemedi")}}async function N(e){let{error:s}=await t.rpc("admin_message_delete_hard",{p_msg_id:e});s||h(t=>t.filter(t=>t.id!==e))}async function w(){for(let e of Object.keys(p).filter(e=>p[e]).map(Number))await t.rpc("admin_message_delete_hard",{p_msg_id:e});h(e=>e.filter(e=>!p[e.id])),y({})}return(0,n.useEffect)(()=>{v(!1)},[v]),(0,n.useEffect)(()=>{let e=setInterval(()=>v(!0),9e3);return()=>clearInterval(e)},[v]),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,i.jsx)("h3",{children:"\uD83D\uDCDE Canlı Destek Konuşmaları (admin taraflı)"}),(0,i.jsx)("button",{className:"ghost",onClick:()=>v(!0),children:"Yenile"})]}),(0,i.jsxs)("div",{className:"grid2",children:[(0,i.jsx)("div",{children:(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"ID"}),(0,i.jsx)("th",{children:"Buyer/Seller"}),(0,i.jsx)("th",{children:"Oluşturulma"}),(0,i.jsx)("th",{})]})}),(0,i.jsxs)("tbody",{children:[(l||[]).map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsxs)("td",{children:["#",e.id]}),(0,i.jsxs)("td",{style:{fontSize:12},children:[(0,i.jsxs)("div",{children:["buyer: ",(0,i.jsx)("code",{children:e.buyer_auth_id})]}),(0,i.jsxs)("div",{children:["seller: ",(0,i.jsx)("code",{children:e.seller_auth_id})]})]}),(0,i.jsx)("td",{children:d(e.created_at)}),(0,i.jsx)("td",{children:(0,i.jsx)("button",{className:"btn",onClick:()=>b(e.id),children:"A\xe7"})})]},e.id)),!(null==l?void 0:l.length)&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:4,className:"muted",children:"Kayıt yok."})})]})]})}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,i.jsxs)("h4",{children:["Konuşma #",c||"-"]}),(0,i.jsx)("div",{className:"row",children:(0,i.jsx)("button",{className:"ghost",onClick:w,disabled:!Object.values(p).some(e=>e),children:"Se\xe7ili Mesajları Sil"})})]}),(0,i.jsxs)("div",{style:{maxHeight:420,overflow:"auto",border:"2px solid var(--accent)",borderRadius:10,padding:10,boxShadow:"0 0 0 1px var(--accent) inset, 0 0 10px var(--accent-soft)"},children:[u.map(e=>(0,i.jsxs)("div",{style:{borderBottom:"1px dashed #3a3a3a",padding:"6px 0"},children:[(0,i.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,i.jsxs)("div",{style:{fontSize:12,color:"#aab4c0"},children:["#",e.id," • ",d(e.created_at)]}),(0,i.jsxs)("label",{style:{fontSize:12},children:[(0,i.jsx)("input",{type:"checkbox",checked:!!p[e.id],onChange:t=>y(s=>({...s,[e.id]:t.target.checked}))})," se\xe7"]})]}),(0,i.jsxs)("div",{style:{fontSize:12,margin:"4px 0"},children:[(0,i.jsx)("b",{children:"from"})," ",(0,i.jsx)("code",{children:e.sender_auth_id})," → ",(0,i.jsx)("b",{children:"to"})," ",(0,i.jsx)("code",{children:e.receiver_auth_id})]}),(0,i.jsx)("div",{children:e.body}),(0,i.jsx)("div",{className:"row",style:{marginTop:6},children:(0,i.jsx)("button",{className:"ghost",onClick:()=>N(e.id),children:"Kalıcı Sil"})})]},e.id)),!u.length&&(0,i.jsx)("div",{className:"muted",children:"Mesaj yok."})]}),(0,i.jsxs)("div",{className:"row",style:{marginTop:10},children:[(0,i.jsx)("input",{className:"input",style:{flex:1},placeholder:"Yanıt yaz…",value:m,onChange:e=>j(e.target.value)}),(0,i.jsx)("button",{className:"btn",onClick:g,children:"G\xf6nder"})]}),x&&(0,i.jsx)("div",{className:"err",style:{marginTop:8},children:x})]})]})]})}function m(e){let{supa:t,audioRef:s}=e,[a,l]=(0,n.useState)(""),[r,c]=(0,n.useState)(null),[o,u]=(0,n.useState)([]),[h,m]=(0,n.useState)(null),[j,x]=(0,n.useState)([]),[f,p]=(0,n.useState)({}),[y,_]=(0,n.useState)("");async function v(){_(""),c(null),u([]),x([]),m(null),p({});let e=a.trim();if(!e){_("Arama kutusuna e-posta veya UUID girin.");return}let s=null;if(e.includes("@")){let i=await t.from("users").select("auth_user_id,email,full_name").ilike("email",e);s=i.data&&i.data[0]}else s=(await t.from("users").select("auth_user_id,email,full_name").eq("auth_user_id",e).single()).data;if(!s){_("Kullanıcı bulunamadı.");return}c(s);let{data:i}=await t.from("conversations").select("id,buyer_auth_id,seller_auth_id,created_at").or("buyer_auth_id.eq.".concat(s.auth_user_id,",seller_auth_id.eq.").concat(s.auth_user_id)).order("id",{ascending:!1});u(i||[])}let b=(0,n.useCallback)(async e=>{m(e);let{data:s}=await t.from("messages").select("id,conv_id,sender_auth_id,receiver_auth_id,body,created_at").eq("conv_id",e).order("created_at",{ascending:!0}).limit(1e3);x(s||[]),p({})},[t]);async function g(e){await t.rpc("admin_message_delete_hard",{p_msg_id:e}),x(t=>t.filter(t=>t.id!==e))}async function N(){for(let e of Object.keys(f).filter(e=>f[e]).map(Number))await t.rpc("admin_message_delete_hard",{p_msg_id:e});x(e=>e.filter(e=>!f[e.id])),p({})}return(0,i.jsxs)("div",{className:"card",children:[(0,i.jsx)("h3",{children:"\uD83D\uDCAC Kullanıcı Mesajları"}),(0,i.jsxs)("div",{className:"row",style:{marginBottom:12},children:[(0,i.jsx)("input",{className:"input",style:{flex:1},placeholder:"E-posta veya UUID ile ara (\xf6r: ayse@... / 76fb...)",value:a,onChange:e=>l(e.target.value)}),(0,i.jsx)("button",{className:"btn",onClick:v,children:"Ara"})]}),y&&(0,i.jsx)("div",{className:"muted",style:{marginBottom:8},children:y}),r&&(0,i.jsxs)("div",{className:"card",style:{marginBottom:12},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Kullanıcı:"})," ",r.full_name||"-"," — ",r.email||"-"]}),(0,i.jsxs)("div",{style:{fontSize:12,opacity:.9},children:["UUID: ",(0,i.jsx)("code",{children:r.auth_user_id})]})]}),(0,i.jsxs)("div",{className:"grid2",children:[(0,i.jsx)("div",{children:(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"ID"}),(0,i.jsx)("th",{children:"Buyer/Seller"}),(0,i.jsx)("th",{children:"Oluşturma"}),(0,i.jsx)("th",{})]})}),(0,i.jsxs)("tbody",{children:[(o||[]).map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsxs)("td",{children:["#",e.id]}),(0,i.jsxs)("td",{style:{fontSize:12},children:[(0,i.jsxs)("div",{children:["buyer: ",(0,i.jsx)("code",{children:e.buyer_auth_id})]}),(0,i.jsxs)("div",{children:["seller: ",(0,i.jsx)("code",{children:e.seller_auth_id})]})]}),(0,i.jsx)("td",{children:d(e.created_at)}),(0,i.jsx)("td",{children:(0,i.jsx)("button",{className:"btn",onClick:()=>b(e.id),children:"A\xe7"})})]},e.id)),!(null==o?void 0:o.length)&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:4,className:"muted",children:"Konuşma yok."})})]})]})}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,i.jsxs)("h4",{children:["Konuşma #",h||"-"]}),(0,i.jsx)("button",{className:"ghost",onClick:N,disabled:!Object.values(f).some(e=>e),children:"Se\xe7ili Mesajları Sil"})]}),(0,i.jsxs)("div",{style:{maxHeight:420,overflow:"auto",border:"2px solid var(--accent)",borderRadius:10,padding:10,boxShadow:"0 0 0 1px var(--accent) inset, 0 0 10px var(--accent-soft)"},children:[j.map(e=>(0,i.jsxs)("div",{style:{borderBottom:"1px dashed #3a3a3a",padding:"6px 0"},children:[(0,i.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,i.jsxs)("div",{style:{fontSize:12,color:"#aab4c0"},children:["#",e.id," • ",d(e.created_at)]}),(0,i.jsxs)("label",{style:{fontSize:12},children:[(0,i.jsx)("input",{type:"checkbox",checked:!!f[e.id],onChange:t=>p(s=>({...s,[e.id]:t.target.checked}))})," se\xe7"]})]}),(0,i.jsxs)("div",{style:{fontSize:12,margin:"4px 0"},children:[(0,i.jsx)("b",{children:"from"})," ",(0,i.jsx)("code",{children:e.sender_auth_id})," → ",(0,i.jsx)("b",{children:"to"})," ",(0,i.jsx)("code",{children:e.receiver_auth_id})]}),(0,i.jsx)("div",{children:e.body}),(0,i.jsx)("div",{className:"row",style:{marginTop:6},children:(0,i.jsx)("button",{className:"ghost",onClick:()=>g(e.id),children:"Kalıcı Sil"})})]},e.id)),!j.length&&(0,i.jsx)("div",{className:"muted",children:"Mesaj yok."})]})]})]})]})}function j(e){let{supa:t}=e,[s,a]=(0,n.useState)([]),l=(0,n.useCallback)(async()=>{let{data:e}=await t.from("listings").select("id,title,created_at,city,district,price,currency,status,expires_at,is_showcase,seller_auth_id").eq("status","pending").order("created_at",{ascending:!1}).limit(200);a(e||[])},[t]);async function r(e){let{error:s}=await t.from("listings").update({status:"active"}).eq("id",e);s||a(t=>t.filter(t=>t.id!==e))}async function c(e){let{error:s}=await t.from("listings").update({status:"rejected"}).eq("id",e);s||a(t=>t.filter(t=>t.id!==e))}async function d(e){await t.from("listings").delete().eq("id",e),a(t=>t.filter(t=>t.id!==e))}return(0,n.useEffect)(()=>{l()},[l]),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,i.jsx)("h3",{children:"\uD83D\uDCDD Onay Bekleyen İlanlar"}),(0,i.jsx)("button",{className:"ghost",onClick:l,children:"Yenile"})]}),(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"ID"}),(0,i.jsx)("th",{children:"Başlık"}),(0,i.jsx)("th",{children:"Satıcı"}),(0,i.jsx)("th",{children:"Konum"}),(0,i.jsx)("th",{children:"Fiyat"}),(0,i.jsx)("th",{})]})}),(0,i.jsxs)("tbody",{children:[(s||[]).map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsxs)("td",{children:["#",e.id]}),(0,i.jsx)("td",{children:e.title}),(0,i.jsx)("td",{children:(0,i.jsx)("code",{children:e.seller_auth_id})}),(0,i.jsxs)("td",{children:[e.city," ",e.district?"/ ".concat(e.district):""]}),(0,i.jsx)("td",{children:e.price?"".concat(e.price," ").concat(e.currency||"TRY"):"-"}),(0,i.jsxs)("td",{className:"row",children:[(0,i.jsx)("button",{className:"btn",onClick:()=>r(e.id),children:"Onayla"}),(0,i.jsx)("button",{className:"ghost",onClick:()=>c(e.id),children:"Reddet"}),(0,i.jsx)("button",{className:"ghost",onClick:()=>d(e.id),children:"Sil"})]})]},e.id)),!(null==s?void 0:s.length)&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:6,className:"muted",children:"Bekleyen ilan yok."})})]})]})]})}function x(e){let{supa:t}=e,[s,a]=(0,n.useState)([]),[l,r]=(0,n.useState)(""),c=(0,n.useCallback)(async()=>{let{data:e}=await t.from("listings").select("id,title,is_showcase,created_at,price,currency,city,status,seller_auth_id").eq("status","active").order("created_at",{ascending:!1}).limit(200);a(e||[])},[t]);async function d(e){r("");let{error:s}=await t.from("listings").update({is_showcase:!e.is_showcase}).eq("id",e.id);s?r(s.message):c()}async function u(e){await t.from("listings").delete().eq("id",e),a(t=>t.filter(t=>t.id!==e))}return(0,n.useEffect)(()=>{c()},[c]),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,i.jsx)("h3",{children:"✨ Vitrin / PRO"}),(0,i.jsx)("button",{className:"ghost",onClick:c,children:"Yenile"})]}),l&&(0,i.jsx)("div",{className:"err",style:{marginBottom:8},children:l}),(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"ID"}),(0,i.jsx)("th",{children:"Başlık"}),(0,i.jsx)("th",{children:"Satıcı"}),(0,i.jsx)("th",{children:"Fiyat"}),(0,i.jsx)("th",{children:"Konum"}),(0,i.jsx)("th",{children:"Vitrin"}),(0,i.jsx)("th",{})]})}),(0,i.jsxs)("tbody",{children:[(s||[]).map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsxs)("td",{children:["#",e.id]}),(0,i.jsx)("td",{children:e.title}),(0,i.jsx)("td",{children:(0,i.jsx)("code",{children:e.seller_auth_id})}),(0,i.jsx)("td",{children:e.price?"".concat(e.price," ").concat(e.currency||"TRY"):"-"}),(0,i.jsx)("td",{children:e.city||"-"}),(0,i.jsx)("td",{children:o(e.is_showcase)}),(0,i.jsxs)("td",{className:"row",children:[(0,i.jsx)("button",{className:"btn",onClick:()=>d(e),children:e.is_showcase?"Vitrinden \xc7ıkar":"Vitrine Ekle"}),(0,i.jsx)("button",{className:"ghost",onClick:()=>u(e.id),children:"Sil"})]})]},e.id)),!(null==s?void 0:s.length)&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:7,className:"muted",children:"Aktif ilan yok."})})]})]})]})}function f(e){var t;let{supa:s}=e,[a,l]=(0,n.useState)([]),[r,c]=(0,n.useState)(12),[u,h]=(0,n.useState)(""),[m,j]=(0,n.useState)("all"),[x,f]=(0,n.useState)(null),[p,y]=(0,n.useState)([]),_=(0,n.useCallback)(async()=>{let{data:e}=await s.from("users").select("auth_user_id,email,full_name,role,premium_until,created_at").order("created_at",{ascending:!1}).limit(300);l(await Promise.all((e||[]).map(async e=>{let{count:t}=await s.from("listings").select("id",{count:"exact",head:!0}).eq("seller_auth_id",e.auth_user_id);return{...e,listing_count:t||0}})))},[s]);function v(){return"maker"===m?a.filter(e=>e.listing_count>0):"customer"===m?a.filter(e=>!e.listing_count):a}async function b(e,t){h("");let{error:i}=await s.from("users").update({role:t}).eq("auth_user_id",e);i?h(i.message):_()}async function g(e){h("");let t=Number(r)||12;if((await s.rpc("admin_grant_pro",{p_user_id:e,p_months:t})).error){let{data:i}=await s.from("users").select("premium_until").eq("auth_user_id",e).single(),n=new Date,a=(null==i?void 0:i.premium_until)?new Date(i.premium_until):n,l=new Date(a>n?a:n);l.setMonth(l.getMonth()+t);let r=l.toISOString(),{error:c}=await s.from("users").update({premium_until:r}).eq("auth_user_id",e);if(c){h(c.message);return}}_()}async function N(e){f(e);let{data:t}=await s.from("listings").select("id,title,status,is_showcase,price,currency,city,created_at").eq("seller_auth_id",e.auth_user_id).order("created_at",{ascending:!1}).limit(300);y(t||[])}async function w(e){await s.from("listings").update({status:"active"}).eq("id",e),y(t=>t.map(t=>t.id===e?{...t,status:"active"}:t))}async function k(e){await s.from("listings").update({status:"rejected"}).eq("id",e),y(t=>t.map(t=>t.id===e?{...t,status:"rejected"}:t))}async function C(e){await s.from("listings").delete().eq("id",e),y(t=>t.filter(t=>t.id!==e))}return(0,n.useEffect)(()=>{_()},[_]),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,i.jsx)("h3",{children:"\uD83D\uDC65 Kullanıcılar"}),(0,i.jsxs)("div",{className:"row",children:[(0,i.jsx)("label",{style:{fontSize:12},children:"Filtre:"}),(0,i.jsxs)("select",{className:"input",value:m,onChange:e=>j(e.target.value),children:[(0,i.jsx)("option",{value:"all",children:"Hepsi"}),(0,i.jsx)("option",{value:"maker",children:"\xdcreten El (ilanı olan)"}),(0,i.jsx)("option",{value:"customer",children:"M\xfcşteri (ilanı olmayan)"})]}),(0,i.jsx)("button",{className:"ghost",onClick:_,children:"Yenile"})]})]}),u&&(0,i.jsx)("div",{className:"err",style:{marginBottom:8},children:u}),(0,i.jsxs)("div",{className:"row",style:{marginBottom:8},children:[(0,i.jsx)("label",{children:"PRO ay:"}),(0,i.jsx)("input",{className:"input",style:{width:90},type:"number",min:"1",max:"36",value:r,onChange:e=>c(e.target.value)})]}),(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"E-posta"}),(0,i.jsx)("th",{children:"Ad"}),(0,i.jsx)("th",{children:"Rol"}),(0,i.jsx)("th",{children:"PRO Bitiş"}),(0,i.jsx)("th",{children:"İlan"}),(0,i.jsx)("th",{children:"Kayıt"}),(0,i.jsx)("th",{children:"İşlem"})]})}),(0,i.jsxs)("tbody",{children:[(v()||[]).map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.email||"-"}),(0,i.jsx)("td",{children:e.full_name||"-"}),(0,i.jsx)("td",{children:(0,i.jsx)("b",{children:e.role||"user"})}),(0,i.jsx)("td",{children:e.premium_until?d(e.premium_until):"—"}),(0,i.jsx)("td",{children:e.listing_count||0}),(0,i.jsx)("td",{children:d(e.created_at)}),(0,i.jsxs)("td",{className:"row",children:[(0,i.jsx)("button",{className:"ghost",onClick:()=>b(e.auth_user_id,"user"),children:"user"}),(0,i.jsx)("button",{className:"ghost",onClick:()=>b(e.auth_user_id,"moderator"),children:"moderator"}),(0,i.jsx)("button",{className:"ghost",onClick:()=>b(e.auth_user_id,"admin"),children:"admin"}),(0,i.jsxs)("button",{className:"btn",onClick:()=>g(e.auth_user_id),children:["PRO Ver (+",r,")"]}),(0,i.jsx)("button",{className:"btn",onClick:()=>N(e),children:"Profili A\xe7"})]})]},e.auth_user_id)),!(null===(t=v())||void 0===t?void 0:t.length)&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:7,className:"muted",children:"Kayıt yok."})})]})]}),x&&(0,i.jsxs)("div",{className:"card",style:{marginTop:14},children:[(0,i.jsxs)("h4",{children:["\uD83D\uDC64 Profil • ",x.full_name||"-"," — ",x.email||"-"]}),(0,i.jsxs)("div",{style:{fontSize:12,opacity:.9,marginBottom:8},children:["UUID: ",(0,i.jsx)("code",{children:x.auth_user_id})]}),(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"ID"}),(0,i.jsx)("th",{children:"Başlık"}),(0,i.jsx)("th",{children:"Durum"}),(0,i.jsx)("th",{children:"Vitrin"}),(0,i.jsx)("th",{children:"Fiyat"}),(0,i.jsx)("th",{children:"Şehir"}),(0,i.jsx)("th",{})]})}),(0,i.jsxs)("tbody",{children:[(p||[]).map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsxs)("td",{children:["#",e.id]}),(0,i.jsx)("td",{children:e.title}),(0,i.jsx)("td",{children:e.status}),(0,i.jsx)("td",{children:o(e.is_showcase)}),(0,i.jsx)("td",{children:e.price?"".concat(e.price," ").concat(e.currency||"TRY"):"-"}),(0,i.jsx)("td",{children:e.city||"-"}),(0,i.jsxs)("td",{className:"row",children:[(0,i.jsx)("button",{className:"btn",onClick:()=>w(e.id),children:"Onayla"}),(0,i.jsx)("button",{className:"ghost",onClick:()=>k(e.id),children:"Reddet"}),(0,i.jsx)("button",{className:"ghost",onClick:()=>C(e.id),children:"Sil"})]})]},e.id)),!(null==p?void 0:p.length)&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:7,className:"muted",children:"İlan yok."})})]})]})]})]})}function p(e){let{supa:t,audioRef:s}=e,[a,l]=(0,n.useState)([]),[r,c]=(0,n.useState)(""),d=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{let{data:i,error:n}=await t.from("reports").select("id, created_at, type, ref_id, reporter_auth_id, note, status");if(n){l([]);return}if(l(i||[]),e&&s.current)try{s.current.currentTime=0,s.current.play()}catch(e){}}catch(e){l([])}},[t,s]);async function o(e,s){c("");let{error:i}=await t.from("reports").update({status:s}).eq("id",e);i?c(i.message):d(!1)}return(0,n.useEffect)(()=>{d(!1)},[d]),(0,n.useEffect)(()=>{let e=setInterval(()=>d(!0),15e3);return()=>clearInterval(e)},[d]),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,i.jsx)("h3",{children:"\uD83D\uDEA9 Şikayetler"}),(0,i.jsx)("button",{className:"ghost",onClick:()=>d(!0),children:"Yenile"})]}),r&&(0,i.jsx)("div",{className:"err",style:{marginBottom:8},children:r}),(0,i.jsxs)("table",{className:"table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"ID"}),(0,i.jsx)("th",{children:"T\xfcr"}),(0,i.jsx)("th",{children:"Referans"}),(0,i.jsx)("th",{children:"Rapor Eden"}),(0,i.jsx)("th",{children:"Not"}),(0,i.jsx)("th",{children:"Durum"}),(0,i.jsx)("th",{})]})}),(0,i.jsxs)("tbody",{children:[(a||[]).map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsxs)("td",{children:["#",e.id]}),(0,i.jsx)("td",{children:e.type||"-"}),(0,i.jsx)("td",{children:e.ref_id||"-"}),(0,i.jsx)("td",{children:(0,i.jsx)("code",{children:e.reporter_auth_id})}),(0,i.jsx)("td",{children:e.note||"-"}),(0,i.jsx)("td",{children:e.status||"open"}),(0,i.jsxs)("td",{className:"row",children:[(0,i.jsx)("button",{className:"ghost",onClick:()=>o(e.id,"in_review"),children:"İncele"}),(0,i.jsx)("button",{className:"btn",onClick:()=>o(e.id,"closed"),children:"Kapattım"})]})]},e.id)),!(null==a?void 0:a.length)&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:7,className:"muted",children:"Şikayet yok (veya tablo yok)."})})]})]})]})}function y(e){let{supa:t}=e,[s,a]=(0,n.useState)(""),[l,r]=(0,n.useState)(""),[c,d]=(0,n.useState)("");async function o(){if(d(""),!s.trim()||!l.trim()){d("Başlık ve mesaj zorunlu.");return}let{error:e}=await t.from("broadcasts").insert({title:s,body:l});if(e){d("Broadcast tablosu yoksa: admin kullanıcılarına e-posta veya push entegre edin.");return}a(""),r(""),d("G\xf6nderildi.")}return(0,i.jsxs)("div",{className:"card",children:[(0,i.jsx)("h3",{children:"\uD83D\uDCE3 Bildiri G\xf6nder"}),(0,i.jsx)("div",{className:"row",style:{marginTop:8},children:(0,i.jsx)("input",{className:"input",style:{flex:1},placeholder:"Başlık",value:s,onChange:e=>a(e.target.value)})}),(0,i.jsx)("div",{className:"row",style:{marginTop:8},children:(0,i.jsx)("textarea",{className:"input",rows:5,style:{width:"100%"},placeholder:"Mesaj i\xe7eriği",value:l,onChange:e=>r(e.target.value)})}),(0,i.jsxs)("div",{className:"row",style:{marginTop:8},children:[(0,i.jsx)("button",{className:"btn",onClick:o,children:"G\xf6nder"}),c&&(0,i.jsx)("div",{className:"muted",children:c})]})]})}},7663:function(e){!function(){var t={229:function(e){var t,s,i,n=e.exports={};function a(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function r(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(s){try{return t.call(null,e,0)}catch(s){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{s="function"==typeof clearTimeout?clearTimeout:l}catch(e){s=l}}();var c=[],d=!1,o=-1;function u(){d&&i&&(d=!1,i.length?c=i.concat(c):o=-1,c.length&&h())}function h(){if(!d){var e=r(u);d=!0;for(var t=c.length;t;){for(i=c,c=[];++o<t;)i&&i[o].run();o=-1,t=c.length}i=null,d=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===l||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function j(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];c.push(new m(e,t)),1!==c.length||d||r(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=j,n.addListener=j,n.once=j,n.off=j,n.removeListener=j,n.removeAllListeners=j,n.emit=j,n.prependListener=j,n.prependOnceListener=j,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},s={};function i(e){var n=s[e];if(void 0!==n)return n.exports;var a=s[e]={exports:{}},l=!0;try{t[e](a,a.exports,i),l=!1}finally{l&&delete s[e]}return a.exports}i.ab="//";var n=i(229);e.exports=n}()},9008:function(e,t,s){e.exports=s(3867)}},function(e){e.O(0,[941,888,774,179],function(){return e(e.s=7953)}),_N_E=e.O()}]);